<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="时间就是一个小偷,它让你猝不及防地失去,那些你很容易忽略掉的东西,当你记起时，却怎么也找不着了...">
<meta property="og:type" content="website">
<meta property="og:title" content="HuJian&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="HuJian&#39;s Blog">
<meta property="og:description" content="时间就是一个小偷,它让你猝不及防地失去,那些你很容易忽略掉的东西,当你记起时，却怎么也找不着了...">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="HuJian&#39;s Blog">
<meta name="twitter:description" content="时间就是一个小偷,它让你猝不及防地失去,那些你很容易忽略掉的东西,当你记起时，却怎么也找不着了...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>HuJian's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HuJian's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/21/koa-源码解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/21/koa-源码解析/" itemprop="url">koa 源码解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-21T14:16:07+08:00">
                2019-02-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/21/koa-源码解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/21/koa-源码解析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>koa 框架是基于 Node.js 下一代的 web server 框架, 舍弃了回调写法, 提高了错误处理效率, 而且其不绑定任何中间件, 核心代码只提供优雅轻量的函数库.<br>平时经常使用到 koa 框架, 所以希望通过阅读源码学习其思想, 本文是基于 koa2 的源码进行分析.</p>
<h1 id="koa-整体架构"><a href="#koa-整体架构" class="headerlink" title="koa 整体架构"></a>koa 整体架构</h1><p>koa 框架的源码结构非常简单, 在 lib 文件夹下, 只有 4 个文件, 分别是 application.js, context.js, request.js, response.js.<br>而 application.js 是 koa 框架的入口文件, context.js 的作用是创建网络请求的上下文对象, request.js 是用于包装 koa 的 request 对象的, response.js<br>则是用于包装 koa 的 response 对象的. 我们这里使用 koa 框架建立一个简单的 node 服务, 以此来逐步了解 koa 内部机理.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> koa();</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) &#123;</span><br><span class="line">  ctx.body = <span class="string">'Hello World'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<p>上面的代码, 先生成了一个 koa 对象, 然后通过使用 use 函数往 server 中添加中间件函数, 最后使用 listen 函数进行对 3000 端口的监听.</p>
<h1 id="koa-源码剖析"><a href="#koa-源码剖析" class="headerlink" title="koa 源码剖析"></a>koa 源码剖析</h1><p>由上面的简单代码, 我们会有几个疑问: koa 对象中包含了些什么属性与方法? use 函数对于中间件函数的处理是怎么样的? listen 函数做了什么?<br>因此我们先来看一下 application.js 的源码:</p>
<h2 id="application-js"><a href="#application-js" class="headerlink" title="application.js"></a>application.js</h2><p>application.js 暴露了一个 Application 类供我们使用, 也即是说, 我们 new 一个 koa 对象实质上就是新建一个 Application 的实例对象. 而 Application 类是继承<br>于 EventEmitter (Node.js events 模块)的, 所以我们在 koa 实例对象上可以使用 on, emit 等方法进行事件监听.</p>
<h3 id="生成-application-对象"><a href="#生成-application-对象" class="headerlink" title="生成 application 对象"></a>生成 application 对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">Emitter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>(); <span class="comment">// 因为继承于 EventEmitter, 这里需要调用 super</span></span><br><span class="line">        <span class="keyword">this</span>.proxy = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.middleware = [];</span><br><span class="line">        <span class="keyword">this</span>.subdomainOffset = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">this</span>.env = process.env.NODE_ENV || <span class="string">'development'</span>;</span><br><span class="line">        <span class="keyword">this</span>.context = <span class="built_in">Object</span>.create(context);</span><br><span class="line">        <span class="keyword">this</span>.request = <span class="built_in">Object</span>.create(request);</span><br><span class="line">        <span class="keyword">this</span>.response = <span class="built_in">Object</span>.create(response);</span><br><span class="line">        <span class="keyword">if</span> (util.inspect.custom) &#123;</span><br><span class="line">        <span class="keyword">this</span>[util.inspect.custom] = <span class="keyword">this</span>.inspect;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到在 constructor 函数中, 实例对象会初始化几个重要的属性, proxy 属性是代理设置, middleware 属性是中间件数组, 用于存储中间件函数的, subdomainOffset 属性是子域名偏移量<br>设置, env 属性保存 node 的环境变量 NODE_ENV 值, context, requets, response 则是 koa 自身的包装的 context 对象, request 对象, response 对象. 这里特别讲解一下 proxy 属性与<br>subdomainOffset 属性. proxy 属性值是 true 或者 false, 它的作用在于是否获取真正的客户端 ip 地址(详细请看附录的第一点). subdomainOffset 属性会改变获取 subdomain 时返回数组的值,<br>比如 test.page.example.com 域名, 如果设置 subdomainOffset 为 2, 那么返回的数组值为 [“page”, “test”], 如果设置为 3, 那么返回数组值为 [“test”].</p>
<h3 id="use-与中间件"><a href="#use-与中间件" class="headerlink" title="use 与中间件"></a>use 与中间件</h3><p>use 函数内部仅仅是对 generator 函数利用 koa-convert 库进行转化(将 generator 函数包装成 Promise), 如果不是则不转化, 然后将这个中间件函数 push 进实例对象的 middleware 数组中.<br>所以, 所谓中间件函数的串联其实就是通过数组来逐个执行的, 至于 koa 是怎么利用 koa-compose 建立起核心的中间件机制的, 这里按下不表, 详细请阅读本人的 理解 koa 中间件机制 博文.</p>
<h3 id="listen-原理"><a href="#listen-原理" class="headerlink" title="listen 原理"></a>listen 原理</h3><p>listen 函数的原理其实很简单, 它实际上是一个缩写的函数, 它本质上就是在内部通过 Node 原生的 http 模块建立起一个 http server, 而这个 http server 的回调函数使用的是 koa 中的 callback 函数.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">listen(...args) &#123;</span><br><span class="line">  debug(<span class="string">'listen'</span>);</span><br><span class="line">  <span class="keyword">const</span> server = http.createServer(<span class="keyword">this</span>.callback());</span><br><span class="line">  <span class="keyword">return</span> server.listen(...args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面就来讲解一下核心的 callback 函数.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">callback() &#123;</span><br><span class="line">  <span class="keyword">const</span> fn = compose(<span class="keyword">this</span>.middleware);  <span class="comment">// 使用 compose 建立中间件机制</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.listeners(<span class="string">'error'</span>).length) <span class="keyword">this</span>.on(<span class="string">'error'</span>, <span class="keyword">this</span>.onerror);  <span class="comment">// 如果没有对 error 事件进行监听, 那么绑定 error 事件监听处理</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// handleRequest 函数相当于 http.creatServer 的回调函数, 有 req, res 两个参数, 代表原生的 request, response 对象.</span></span><br><span class="line">  <span class="keyword">const</span> handleRequest = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> ctx = <span class="keyword">this</span>.createContext(req, res); <span class="comment">// 每次接受一个新的请求就是生成一次全新的 context</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.handleRequest(ctx, fn);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> handleRequest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">handleRequest(ctx, fnMiddleware) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = ctx.res;</span><br><span class="line">  res.statusCode = <span class="number">404</span>;</span><br><span class="line">  <span class="keyword">const</span> onerror = <span class="function"><span class="params">err</span> =&gt;</span> ctx.onerror(err); <span class="comment">// 错误处理</span></span><br><span class="line">  <span class="keyword">const</span> handleResponse = <span class="function"><span class="params">()</span> =&gt;</span> respond(ctx); <span class="comment">// 响应处理</span></span><br><span class="line">  onFinished(res, onerror); <span class="comment">// 为 res 对象添加错误处理响应, 当 res 响应结束时, 执行 context 中的 onerror 函数(这里需要注意区分 context 与 koa 实例中的 onerror)</span></span><br><span class="line">  <span class="keyword">return</span> fnMiddleware(ctx).then(handleResponse).catch(onerror); <span class="comment">// 执行中间件数组所有函数, 并结束时调用 respond 函数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对于 this.createContext 函数, 它的用于就是生成一个新的 context 对象并建立 koa 中 context, requets, response 属性之间与原生 http 对象的关系的.而 handleRequest 函数只是负责执行<br>中间件所有的函数, 并在中间件函数执行结束的时候调用 respond.<br>对于在 koa 中的 context 对象, request 对象, response 对象与 http 模块原生的 req 与 res 之间的关系我并不打算陈列代码, 下面我以图解的形式来帮助阅读:</p>
<img src="http://weixinfactory.di1game.com/blog/applicaton.png">
<h3 id="对请求的响应处理-respond"><a href="#对请求的响应处理-respond" class="headerlink" title="对请求的响应处理 respond"></a>对请求的响应处理 respond</h3><p>对于 respond 函数, 其核心就是根据不同类型的数据对 http 的响应头部与响应体 body 做对应的处理.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">respond</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// allow bypassing koa</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span> === ctx.respond) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> res = ctx.res;</span><br><span class="line">  <span class="comment">// writable 是原生的 response 对象的 writeable 属性, 检查是否是可写流</span></span><br><span class="line">  <span class="keyword">if</span> (!ctx.writable) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> body = ctx.body;</span><br><span class="line">  <span class="keyword">const</span> code = ctx.status;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ignore body</span></span><br><span class="line">  <span class="comment">// 如果响应的 statusCode 是属于 body 为空的类型, 例如 204, 205, 304, 将 body 置为 null</span></span><br><span class="line">  <span class="keyword">if</span> (statuses.empty[code]) &#123;</span><br><span class="line">    <span class="comment">// strip headers</span></span><br><span class="line">    ctx.body = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">return</span> res.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果是 HEAD 方法</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'HEAD'</span> == ctx.method) &#123;</span><br><span class="line">    <span class="comment">// headersSent 属性 Node 原生的 response 对象上的, 用于检查 http 响应头部是否已经被发送</span></span><br><span class="line">    <span class="comment">// 如果头部未被发送, 那么添加 length 头部</span></span><br><span class="line">    <span class="keyword">if</span> (!res.headersSent &amp;&amp; isJSON(body)) &#123;</span><br><span class="line">      ctx.length = Buffer.byteLength(<span class="built_in">JSON</span>.stringify(body));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.end();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// status body</span></span><br><span class="line">  <span class="comment">// 如果 body 值为空</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">null</span> == body) &#123;</span><br><span class="line">    <span class="comment">// body 值为 context 中的 message 属性或 code</span></span><br><span class="line">    body = ctx.message || <span class="built_in">String</span>(code);</span><br><span class="line">    <span class="comment">// 修改头部的 type 与 length 属性</span></span><br><span class="line">    <span class="keyword">if</span> (!res.headersSent) &#123;</span><br><span class="line">      ctx.type = <span class="string">'text'</span>;</span><br><span class="line">      ctx.length = Buffer.byteLength(body);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.end(body);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// responses</span></span><br><span class="line">  <span class="comment">// 对 body 为 buffer 类型的进行处理</span></span><br><span class="line">  <span class="keyword">if</span> (Buffer.isBuffer(body)) <span class="keyword">return</span> res.end(body);</span><br><span class="line">  <span class="comment">// 对 body 为字符串类型的进行处理</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'string'</span> == <span class="keyword">typeof</span> body) <span class="keyword">return</span> res.end(body);</span><br><span class="line">  <span class="comment">// 对 body 为流形式的进行处理</span></span><br><span class="line">  <span class="keyword">if</span> (body <span class="keyword">instanceof</span> Stream) <span class="keyword">return</span> body.pipe(res);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// body: json</span></span><br><span class="line">  <span class="comment">// 对 body 为 json 格式的数据进行处理, 1: 将 body 转化为 json 字符串, 2: 添加 length 头部信息</span></span><br><span class="line">  body = <span class="built_in">JSON</span>.stringify(body);</span><br><span class="line">  <span class="keyword">if</span> (!res.headersSent) &#123;</span><br><span class="line">    ctx.length = Buffer.byteLength(body);</span><br><span class="line">  &#125;</span><br><span class="line">  res.end(body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在 respond 函数中, 主要是运用 node http 模块中的响应对象中的 end 方法与 koa context 对象中代理的属性进行最终响应对象的设置.</p>
<h2 id="request-js"><a href="#request-js" class="headerlink" title="request.js"></a>request.js</h2><p>主要是对原生的 http 模块的 requets 对象进行封装, 其实就是对 request 对象某些属性或方法通过重写 getter/setter 函数进行代理, 请看下面的图进行更好的理解:</p>
<img src="http://weixinfactory.di1game.com/blog/request.png">
<h3 id="内容协商"><a href="#内容协商" class="headerlink" title="内容协商"></a>内容协商</h3><p>我们可以看到 request 中有很多 accept 相关的方法, 我们来看看 accept 相关的内容协商的知识:<br>所谓内容协商, 就是客户端向服务端请求文件, 返回符合某些标准的文件, 而除了服务端将所有版本的文件全部返回由<br>客户端来决定使用哪个版本这种比较浪费网络资源的方法之外, 我们还可以使用通过请求/响应头部进行交流并返回合适版本的方法.</p>
<table>
<thead>
<tr>
<th>请求头字段</th>
<th>解释</th>
<th>对应响应头 </th>
</tr>
</thead>
<tbody>
<tr>
<td>Accept</td>
<td>告诉服务端可以接收的类型(text/html, application/json 等)</td>
<td>Content-Type </td>
</tr>
<tr>
<td>Accept-charset</td>
<td>告诉服务端可以接收的字符集类型(utf8, GBK 等)</td>
<td>Content-Type  </td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>告诉服务端可以接收的压缩类型(gzip, deflate 等)</td>
<td>Content-Encoding  </td>
</tr>
<tr>
<td>Accept-Language</td>
<td>告诉服务端可以接受的语言类型(zh-CN, en 等)</td>
<td>Content-Language  </td>
</tr>
</tbody>
</table>
<p>   使用上面的头部字段就可以达到请求合适的文档类型.而对于客户端与服务端之间可能有多个实体, 比如 CDN, 缓存服务<br>器等等, 万一中间实体缓存了错误的文件版本, 那么后果就是客户端有可能无法正确地解析该文件.所以需要 vary 响应<br>头部字段, vary 字段的值类似于这样: vary: user-agent, location. vary 字段是告诉中间实体如何正确判断有效的<br>缓存文件版本, 比如像上面的值, 那就是利用请求的 user-agent, location 两个头部的字段生成的 hash, 如果再有请<br>求过来并且请求的 ua 与 location 头部字段生成的 hash 有缓存, 那么就返回对应的缓存文件.</p>
<h2 id="response-js"><a href="#response-js" class="headerlink" title="response.js"></a>response.js</h2><p>同样的, response 也是对 http 模块的 response 对象进行封装, 通过对 response 对象的某些属性或方法通过重写 getter/setter 函数进行代理, 请看下面的图帮助理解:<br><img src="http://weixinfactory.di1game.com/blog/koaresponse.png"></p>
<h3 id="Content-disposition"><a href="#Content-disposition" class="headerlink" title="Content-disposition"></a>Content-disposition</h3><p>在 response 对象的 attachment 方法中, 我们可以看到对 HTTP 头部的 Content-disposition 字段进行了处理, 那么究竟 Content-disposition 字段是做什么用的?<br>Content-disposition 是用于说明这个返回的信息是以什么形式展示的, 例如如果值为 inline, 那么就是以网页的一部分或者整个页面展示, 如果是 attachment 的话, 就是以下载附件的<br>形式展示:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: inline; <span class="comment">// 网页一部分或者整个网页展示</span></span><br><span class="line">Content-Disposition: attachment; <span class="comment">// 下载网页附件的形式</span></span><br><span class="line">Content-Disposition: attachment, filename=<span class="string">"xxx.ext"</span>; <span class="comment">// 还可以使用 filename 来指定文件名</span></span><br></pre></td></tr></table></figure>
<p>当然, 在 Content-Type 为 multipart/form-data 格式中, Content-Disposition 也会发挥作用, 用于定义表单的键名:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: multipart/form; boundry=<span class="string">"boundry"</span></span><br><span class="line"></span><br><span class="line">--boundry</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"field1"</span></span><br><span class="line"></span><br><span class="line">value</span><br><span class="line">--boundry</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">"field2"</span></span><br><span class="line"></span><br><span class="line">value</span><br></pre></td></tr></table></figure>
<h3 id="缓存协商"><a href="#缓存协商" class="headerlink" title="缓存协商"></a>缓存协商</h3><p>在 request 中使用 fresh 字段来判断这个请求需要的内容是否是最新的, 其原理也就是我们熟知的 http 缓存机制, 内部通过 fresh 这个库, 判断请求头部中的 if-modify-since 与<br>if-match-since 对比于响应头部中的 last-Modified 字段与 ETag 字段.当然, 在检查这两个字段之前, 还需要检查一下请求头部的 Cache-Control 头部, 如果 Cache-Control 头部<br>是 no-cache, 那么就代表请求信息必须是最新的, 如果不是 no-cache, 接着就需要判断上面说的两个字段.而 last-modified 与 ETag 的检查有没有优先顺序呢? 答案是有的.<br>koa 中先检查 ETag 有没有过期, 手段是通过检查 if-match-since 字段与 Etag 字段是否相同, 然后会检查 last-modified 有没有过期, 手段是通过检查 if-modify-since 与 last-modified<br>的日期是不是 last-modified 日期时间戳小于 if-modified-since 日期时间戳, 如果是那么说明内容是新鲜的, 如果不是说明内容是旧的.</p>
<h2 id="context-js"><a href="#context-js" class="headerlink" title="context.js"></a>context.js</h2><p>分析了上面的 request 与 response, context 的分析更为简单了, context 的核心就是通过 delegates 这一个库, 将 request, response 对象上的属性方法代理到 context 对象上.<br>也就是说例如 this.ctx.headersSent 相当于 this.response.headersSent. request 对象与 response 对象的所有方法与属性都能在 ctx 对象上找到. 这里我们来看一下 delegates 库<br>的属性代理函数的片段, 借此理解一下 context 是如何代理 request 与 response 上的属性与方法的:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delegate(proto, <span class="string">'response'</span>)</span><br><span class="line">  .getter(<span class="string">'headerSent'</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Delegator.prototype.getter = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="comment">// this.proto 指向原型, 这里的 proto 就是上面的 proto, 也就是说 context 对象</span></span><br><span class="line">  <span class="keyword">var</span> proto = <span class="keyword">this</span>.proto;</span><br><span class="line">  <span class="comment">// target 是指 'response' 字符串</span></span><br><span class="line">  <span class="keyword">var</span> target = <span class="keyword">this</span>.target;</span><br><span class="line">  <span class="comment">// 将 name 加入到 delegator 实例对象的getters数组中</span></span><br><span class="line">  <span class="keyword">this</span>.getters.push(name);</span><br><span class="line">  <span class="comment">// 调用原生的 __defineGetter__ 方法进行getter代理,那么 proto[name] 就相当于 proto[target][name]</span></span><br><span class="line">  <span class="comment">// 而 context.response 就相当于 response 对象</span></span><br><span class="line">  <span class="comment">// 由此实现属性代理</span></span><br><span class="line">  proto.__defineGetter__(name, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[target][name];</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><p>在 koa 中, 错误处理分为在 application.js 中的 onerror 处理函数与在 context.js 中的 onerror 处理函数.这两者绑定的位置是不一样的, context 的 onerror 函数是绑定在<br>中间函数数组生成的 Promise 的 catch 中与 res 对象的 onFinished 函数的回调的, 这里的意图显而易见, 就是为了处理请求或响应中出现的 error 事件的.<br>而 application.js 中的 onerror 函数是绑定在 koa 实例对象上的, 它监听的是整个对象的 error 事件.</p>
<h2 id="context-中的错误处理"><a href="#context-中的错误处理" class="headerlink" title="context 中的错误处理"></a>context 中的错误处理</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">onerror(err) &#123;</span><br><span class="line">  <span class="comment">// don't do anything if there is no error.</span></span><br><span class="line">  <span class="comment">// this allows you to pass `this.onerror`</span></span><br><span class="line">  <span class="comment">// to node-style callbacks.</span></span><br><span class="line">  <span class="comment">// 没有错误则忽略, 不执行下面的逻辑</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">null</span> == err) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// 将错误转化为 Error 实例</span></span><br><span class="line">  <span class="keyword">if</span> (!(err <span class="keyword">instanceof</span> <span class="built_in">Error</span>)) err = <span class="keyword">new</span> <span class="built_in">Error</span>(util.format(<span class="string">'non-error thrown: %j'</span>, err));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> headerSent = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.headerSent || !<span class="keyword">this</span>.writable) &#123;</span><br><span class="line">    headerSent = err.headerSent = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// delegate</span></span><br><span class="line">  <span class="comment">// 触发 koa 实例对象的 error 事件, application 上的 onerror 函数会执行</span></span><br><span class="line">  <span class="keyword">this</span>.app.emit(<span class="string">'error'</span>, err, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// nothing we can do here other</span></span><br><span class="line">  <span class="comment">// than delegate to the app-level</span></span><br><span class="line">  <span class="comment">// handler and log.</span></span><br><span class="line">  <span class="comment">// 如果响应头部已经发送(或者 socket 不可写), 那么退出函数</span></span><br><span class="line">  <span class="keyword">if</span> (headerSent) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 获取 http 原生 res 对象</span></span><br><span class="line">  <span class="keyword">const</span> &#123; res &#125; = <span class="keyword">this</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// first unset all headers</span></span><br><span class="line">  <span class="comment">// 根据文档 res.getHeaderNames 函数是 7.7.0 版本后添加的, 这里为了兼容做了一个判断</span></span><br><span class="line">  <span class="comment">// 如果出错那么之前中间件或者其他地方设置的 HTTP 头部就无效了, 应该清空设置</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> res.getHeaderNames === <span class="string">'function'</span>) &#123;</span><br><span class="line">    res.getHeaderNames().forEach(<span class="function"><span class="params">name</span> =&gt;</span> res.removeHeader(name));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res._headers = &#123;&#125;; <span class="comment">// Node &lt; 7.7</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// then set those specified</span></span><br><span class="line">  <span class="keyword">this</span>.set(err.headers);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// force text/plain</span></span><br><span class="line">  <span class="comment">// 出错后响应类型为 text/plain</span></span><br><span class="line">  <span class="keyword">this</span>.type = <span class="string">'text'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ENOENT support</span></span><br><span class="line">  <span class="comment">// 对 ENOENT 错误进行处理, ENOENT 的错误 message 是文件或者路径不存在, 所以状态码应该是 404</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'ENOENT'</span> == err.code) err.status = <span class="number">404</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// default to 500</span></span><br><span class="line">  <span class="comment">// 默认设置状态码为 500</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'number'</span> != <span class="keyword">typeof</span> err.status || !statuses[err.status]) err.status = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// respond</span></span><br><span class="line">  <span class="keyword">const</span> code = statuses[err.status];</span><br><span class="line">  <span class="keyword">const</span> msg = err.expose ? err.message : code;</span><br><span class="line">  <span class="comment">// 设置响应状态码</span></span><br><span class="line">  <span class="keyword">this</span>.status = err.status;</span><br><span class="line">  <span class="comment">// 设置响应 body 长度</span></span><br><span class="line">  <span class="keyword">this</span>.length = Buffer.byteLength(msg);</span><br><span class="line">  <span class="comment">// 返回 message</span></span><br><span class="line">  <span class="keyword">this</span>.res.end(msg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="application-中的错误处理"><a href="#application-中的错误处理" class="headerlink" title="application 中的错误处理"></a>application 中的错误处理</h2><p>application 中的错误处理是对 koa 实例对象中例如函数执行出错等等内部错误进行处理.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">onerror(err) &#123;</span><br><span class="line">  <span class="comment">// 判断 err 是否是 Error 实例</span></span><br><span class="line">  assert(err <span class="keyword">instanceof</span> <span class="built_in">Error</span>, <span class="string">`non-error thrown: <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">// 忽略 404 错误</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="number">404</span> == err.status || err.expose) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// 如果有静默设置, 则忽略</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.silent) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// 打印出出错堆栈</span></span><br><span class="line">  <span class="keyword">const</span> msg = err.stack || err.toString();</span><br><span class="line">  <span class="built_in">console</span>.error();</span><br><span class="line">  <span class="built_in">console</span>.error(msg.replace(<span class="regexp">/^/gm</span>, <span class="string">'  '</span>));</span><br><span class="line">  <span class="built_in">console</span>.error();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数的主要作用就是处理出错函数的堆栈打印, 方便我们进行问题定位.</p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="1-koa-中-proxy-属性真正用途是什么"><a href="#1-koa-中-proxy-属性真正用途是什么" class="headerlink" title="1. koa 中 proxy 属性真正用途是什么?"></a>1. koa 中 proxy 属性真正用途是什么?</h2><p>要知道, 我们在实际运用中, 可能会使用很多的代理服务器, 包括我们常见的正向代理与反向代理, 虽然代理的用处很大, 但是无法避免地我们有时需要知晓真正的客户端的请求 ip,<br>而其实实际上, 服务器并不知道真正的客户端请求 ip, 即使你使用 socket.remoteAddrss 属性来查看, 因为这个请求是代理服务器转发给服务器的, 幸好代理服务器例如 nginx 提供了一个<br>HTTP 头部来记录每次代理服务器的源 IP 地址, 也就是 X-Forwarded-For 头部.形式如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 192.168.210.13, 210.112.40.13, 43.56.210.10</span><br></pre></td></tr></table></figure>
<p>如果一个请求跳转了很多代理服务器, 那么 X-Forwarded-For 头部的 ip 地址就会越多, 第一个就是原始的客户端请求 ip, 第二个就是第一个代理服务器 ip, 以此类推.<br>当然, X-Forwarded-For 并不完全可信, 因为中间的代理服务器可能会”使坏”更改某些 IP. 而 koa 中 proxy 属性的设置就是如果使用 true, 那么就是使用 X-Forwarded-For 头部的第一个<br>ip 地址, 如果使用 false, 则使用 server 中的 socket.remoteAddress 属性值.<br>除了 X-Forwarded-For 之外, proxy 还会影响 X-Forwarded-proto 的使用, 和 X-Forwarded-For 一样, X-Forwarded-proto 记录最开始的请求连接使用的协议类型(HTTP/HTTPS), 因为客户端与<br>服务端之间可能会存在很多层代理服务器, 而代理服务器与服务端之间可能只是使用 HTTP 协议, 并没有使用 HTTPS, 所以 proxy 属性为 true 的话, koa 的 protocol 属性会去取 X-Forwarded-proto 头部的值(koa 中 protocol 属性会先使用 tlsSocket.encrypted 属性来判断是否是 https 协议, 如果是则直接返回 ‘https’).</p>
<h2 id="2-javascript-中的-运算符"><a href="#2-javascript-中的-运算符" class="headerlink" title="2. javascript 中的 ~ 运算符"></a>2. javascript 中的 ~ 运算符</h2><p>~ 运算符是一元运算符, 它的运算逻辑是如下: 例如计算 ~1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 将十进制的 1 转化为二进制的 0001</span><br><span class="line">2. 先对 0001 按位取反: 1110</span><br><span class="line">3. 然后我们知道最高位为 1, 所以数字为负数, 然后将除去最高位剩下的三位数字再按位取反得到 001</span><br><span class="line">4. 然后再向 001 加 1 即 001 + 001 得到 010, 转为十进制为数字 2</span><br><span class="line">5. 再加上我们之前最高位为 1, 所以最后数字为负数即 -2</span><br><span class="line">6. 所以 ~1 === -2</span><br></pre></td></tr></table></figure>
<p>用简略的表达式来说明就是 ~ X = -(X + 1).而我们可以看到在 koa 中, length 返回的结果使用了 ~~length 这样的形式, 两次二进制否运算, 这样的目的是为了值得安全输出, 如果 ~ 运算符后面的值<br>是 NaN, null, 空字符串, 空数组, 非数字字符串的话, 返回值为 -1, 而对于小数, ~ 运算符会向下取整.其实对于小数, ~ 运算会选择忽略小数部分, 对于非整数的值会先执行 Number 类型转化.<br>所以两次二进制否运算 ~~, 可以使小数向下取整, 让非整数值输出为 0(~-1 === 0).</p>
<h2 id="3-Buffer-byteLength-计算长度"><a href="#3-Buffer-byteLength-计算长度" class="headerlink" title="3. Buffer.byteLength 计算长度"></a>3. Buffer.byteLength 计算长度</h2><p>细心阅读源码会发现, 在 koa 中设置响应的 length 头部信息, 并不是使用字符串的 length 属性来设置的, 而是通过 Buffer.byteLength 方法来计算得到的. 为什么要这么做呢?<br>HTTP Content-length 头部的数值其实是字节数而不是字符数, 对于汉字来说, utf-8 编码模式下一个汉字字符需要 3 个字节, 所以不能使用字符串的 length 属性来赋值 Content-Length 头部.</p>
<h2 id="4-Restful-中的幂等性"><a href="#4-Restful-中的幂等性" class="headerlink" title="4. Restful 中的幂等性"></a>4. Restful 中的幂等性</h2><p>我们可以在 request 对象中找到, 有 idempotent 属性, 它用于判断请求方法 verb 是不是幂等的. 所谓幂等性, 就是无论这个相同的请求请求多少次, 得到的数据结果是一样的. 而在 HTTP 的方法中,<br>GET, HEAD, PUT, DELETE, TRACK, OPTIONS 请求都是幂等的. 对于 POST 与 PATCH 方法则是不幂等的.<br>这里特别讲解一下 PUT 的含义, PUT 的定义是 Replace(create or update), 如果存在那么就替换, 如果不存在那么就新增数据.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/21/理解-koa-的中间件机制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/21/理解-koa-的中间件机制/" itemprop="url">理解 koa 的中间件机制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-21T11:40:28+08:00">
                2019-02-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/21/理解-koa-的中间件机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/21/理解-koa-的中间件机制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><p>中间件 在 Node.js 中被广泛使用,它泛指一种特定的设计模式、一系列的处理单元、过滤器和处理程序,以函数的形式存在,连接在一起,形成一个异步队列,来完成对任何数据的预处理和后处理.</p>
<p>它的优点在于 灵活性:使用中间件我们用极少的操作就能得到一个插件,用最简单的方法就能将新的过滤器和处理程序扩展到现有的系统上.</p>
<h2 id="常规中间件模式"><a href="#常规中间件模式" class="headerlink" title="常规中间件模式"></a>常规中间件模式</h2><p>中间件模式中,最基础的组成部分就是 中间件管理器,我们可以用它来组织和执行中间件的函数,如图所示:<br><img src="http://weixinfactory.di1game.com/blog/middleware.png"></p>
<h1 id="面向切面编程-AOP"><a href="#面向切面编程-AOP" class="headerlink" title="面向切面编程(AOP)"></a>面向切面编程(AOP)</h1><p>AOP(面向切面的编程)主要是将一些与核心业务逻辑模块无关的功能抽离出来,这些功能通常包括日志统计,安全控制,或者是异常处理等等.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'核心函数,内部逻辑'</span>); </span><br><span class="line">&#125;</span><br><span class="line">myFunc();  <span class="comment">// 核心函数,内部逻辑</span></span><br></pre></td></tr></table></figure>
<p>before函数:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在原函数执行前执行 fn 函数</span></span><br><span class="line"><span class="built_in">Function</span>.prorotype.before = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">// [Function: myFunc]</span></span><br><span class="line">    <span class="built_in">console</span>.log(fn) <span class="comment">// [Function]</span></span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>; <span class="comment">//用来保存调用这个函数的引用,如myFunc调用此函数,则_this指向myFunc</span></span><br><span class="line">    <span class="comment">//返回一个函数,相当于一个代理函数,也就是说,这里包含了原函数和新函数,原函数指的是myFunc,新函数指的是fn</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">//修正this的指向,将this指针指向fn,将myFunc接收的参数传给fn处理.</span></span><br><span class="line">        <span class="keyword">return</span> _this.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>); <span class="comment">//执行原函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>执行myFunc函数:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myFunc = myFunc.before(<span class="function"><span class="keyword">function</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'预处理'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">myFunc(); <span class="comment">//先输出预处理,再输出核心函数,内部逻辑</span></span><br></pre></td></tr></table></figure></p>
<p>after函数同理:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在原函数执行后执行 fn 函数</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> r = _this.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>); <span class="comment">//先执行原函数,也就是myFunc</span></span><br><span class="line">        fn.apply(<span class="keyword">this</span>,<span class="built_in">arguments</span>);   <span class="comment">//再执行新函数</span></span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">myFunc = myFunc.before(<span class="function"><span class="keyword">function</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'预处理'</span>);  </span><br><span class="line">&#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'后处理'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">myFunc(); <span class="comment">//先输出预处理,再输出核心函数,内部逻辑,最后输出后处理</span></span><br></pre></td></tr></table></figure>
<p>上面这两个函数是通过在 Function.prototype 上添加两个函数: before, after.<br>两个函数的返回值都是一个函数, 这个函数会按照次序执行函数.<br>这样函数各自保持了他们的整洁性.但是这样的 before 与 after 函数的简单使用缺陷也是很明显的,<br>他们并不支持异步的函数, 而日常开发中异步的场景有非常多, 所以这样的代码还是只能在 demo 中使用,不适合生产环境中使用.所以我们来看一下 koa 框架是怎么做的.</p>
<h1 id="koa-中的中间件"><a href="#koa-中的中间件" class="headerlink" title="koa 中的中间件"></a>koa 中的中间件</h1><p>koa 是 nodejs 中非常精简的框架, 其中的精粹思想就是洋葱模型(中间件模型), 它实现的核心就是借助 compose 这个库来实现的.这里我主要看的是 koa2 所使用的 compose 源码,<br>对于 koa1 的 compose 源码其实思想是一致的, 只不过它针对的是 generator 函数, koa2 针对的是 async 函数, 相比之下 async 会更符合潮流.<br>对于 compose 也就是 koa 的核心思想就是像下面这个图:<br><img src="http://weixinfactory.di1game.com/blog/koa-core.png"></p>
<h2 id="那么-compose-是怎么实现上面这个思想的呢"><a href="#那么-compose-是怎么实现上面这个思想的呢" class="headerlink" title="那么 compose 是怎么实现上面这个思想的呢?"></a>那么 compose 是怎么实现上面这个思想的呢?</h2><p>下面我们来解读一下 compose 的源码, compose 的源码非常精简!</p>
<h3 id="middleware-in-koa1"><a href="#middleware-in-koa1" class="headerlink" title="middleware in koa1"></a>middleware in koa1</h3><p>对于 koa1 来说, 它是基于 generator 函数与 co 类库的:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">middleware</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> *(<span class="params">next</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 解释一下传入的 next, 这个传入的 next 函数是在所有中间件执行后的"最后"一个函数, 这里的"最后"并不是真正的最后,</span></span><br><span class="line">    <span class="comment">// 而是像上面那个图中的圆心, 执行完圆心之后, 会返回去执行上一个中间件函数(middleware[length - 1])剩下的逻辑</span></span><br><span class="line">    <span class="comment">// 简称圆心函数</span></span><br><span class="line">    <span class="comment">// 如果没有传入那就就赋值为一个空函数</span></span><br><span class="line">    <span class="keyword">if</span> (!next) next = noop();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i = middleware.length;</span><br><span class="line">    <span class="comment">// 从后往前加载中间件</span></span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      <span class="comment">// 将后面一个函数传给前面的函数作为 next 函数, 前面函数中的 next 参数其实就是下一个中间件函数</span></span><br><span class="line">      next = middleware[i].call(<span class="keyword">this</span>, next);</span><br><span class="line">      <span class="comment">// 这里可以知道 next 函数都是 generator 函数</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'isGenerator:'</span>, (<span class="keyword">typeof</span> next.next === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> next.throw === <span class="string">'function'</span>)); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 使用 yield 委托执行生成器函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">yield</span> *next;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">noop</span>(<span class="params"></span>)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>解释一下 koa1 中的 compose 为什么从后往前遍历中间件函数而且还使用了 call 函数执行了一次, 这个是因为 koa1 中默认函数都是生成器函数, 我们知道生成器函数<br>执行一次并不是真正地执行了函数内部的逻辑, 而是初始化得到一个生成器对象, 而在生成器对象生成的时候, 我们需要对函数需要的 next 函数进行传值, 所以会采用逆序遍历.</p>
<h3 id="middleware-in-koa2"><a href="#middleware-in-koa2" class="headerlink" title="middleware in koa2"></a>middleware in koa2</h3><p>对于 koa2 来说中间件机制 compose 基于 async 与 Promise: 会稍微比 koa1 中的复杂一点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span> (<span class="params">middleware</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 传入的 middleware 参数必须是数组</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(middleware)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Middleware stack must be an array!'</span>)</span><br><span class="line">  <span class="comment">// middleware 数组的元素必须是函数</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> fn <span class="keyword">of</span> middleware) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">'function'</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Middleware must be composed of functions!'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回一个函数闭包, 保持对 middleware 的引用</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 这里的 context 参数是作为一个全局的设置, 所有中间件的第一个参数就是传入的 context, 这样可以</span></span><br><span class="line">    <span class="comment">// 在 context 中对某个值或者某些值做"洋葱处理"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解释一下传入的 next, 这个传入的 next 函数是在所有中间件执行后的"最后"一个函数, 这里的"最后"并不是真正的最后,</span></span><br><span class="line">    <span class="comment">// 而是像上面那个图中的圆心, 执行完圆心之后, 会返回去执行上一个中间件函数(middleware[length - 1])剩下的逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// index 是用来记录中间件函数运行到了哪一个函数</span></span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">-1</span></span><br><span class="line">    <span class="comment">// 执行第一个中间件函数</span></span><br><span class="line">    <span class="keyword">return</span> dispatch(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// i 是洋葱模型的记录已经运行的函数中间件的下标, 如果一个中间件里面运行两次 next, 那么 i 是会比 index 小的.</span></span><br><span class="line">      <span class="comment">// 如果对这个地方不清楚可以查看下面的图</span></span><br><span class="line">      <span class="keyword">if</span> (i &lt;= index) <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'next() called multiple times'</span>))</span><br><span class="line">      index = i</span><br><span class="line">      <span class="keyword">let</span> fn = middleware[i]</span><br><span class="line">      <span class="keyword">if</span> (i === middleware.length) &#123;</span><br><span class="line">        <span class="comment">// 这里的 next 就是一开始 compose 传入的 next, 意味着当中间件函数数列执行完后, 执行这个 next 函数, 即圆心</span></span><br><span class="line">        fn = next</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 如果没有函数, 直接返回空值的 Promise</span></span><br><span class="line">      <span class="keyword">if</span> (!fn) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve()</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 为什么这里要包一层 Promise? </span></span><br><span class="line">        <span class="comment">// 因为 async 需要后面是 Promise, 然后 next 函数返回值就是 dispatch 函数的返回值, </span></span><br><span class="line">        <span class="comment">// 所以运行 async next(); 需要 next 包一层 Promise,next 函数是固定的, 可以执行下一个函数</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(fn(context, <span class="function"><span class="keyword">function</span> <span class="title">next</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> dispatch(i + <span class="number">1</span>)</span><br><span class="line">        &#125;))</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>真正的核心:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span> (<span class="params">middleware</span>) </span>&#123; <span class="comment">// [Promise, Promise, Promise]</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">context, next</span>) </span>&#123; <span class="comment">// next</span></span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">return</span> dispatch(<span class="number">0</span>)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">      index = i</span><br><span class="line">      <span class="keyword">let</span> fn = middleware[i]</span><br><span class="line">      <span class="keyword">if</span> (i === middleware.length) fn = next <span class="comment">// 当运行结束的时候,next赋值给fn,next是undefined</span></span><br><span class="line">      <span class="keyword">if</span> (!fn) <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve() <span class="comment">// !undefined,跳出当前的中间件,执行逻辑函数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(</span><br><span class="line">          fn(context, dispatch.bind(<span class="literal">null</span>, i + <span class="number">1</span>)) <span class="comment">// 此处相当于将上一个函数执行结果的Promise对象传入下一个函数</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>至于在一个中间件函数中两次调用 next 函数导致出错, 我这里提供一个简单的例子供大家参考:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">first</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'1'</span>);</span><br><span class="line">  <span class="comment">// async 与 co + yield 的模型不同, await 是需要后面是 promise 的函数, 并且自己执行一次, 而 co 是自己拿到 value 然后帮你自动执行.</span></span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="keyword">await</span> next(); <span class="comment">// 两次调用 next</span></span><br><span class="line">  <span class="built_in">console</span>.log(ctx);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">second</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'2'</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">third</span>(<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'3'</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'4'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> middleware = [first, second, third];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> com = compose(middleware);</span><br><span class="line"></span><br><span class="line">com(<span class="string">'ctx'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hey'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>如果第一个中间件中没有两次调用 next 函数, 那么正确的结果为 1 2 3 ‘hey’ 4 ‘ctx’. 对于出错的真正原因是如下图:<br><img src="http://weixinfactory.di1game.com/blog/next-err.png"></p>
<p>在第 5 步中, 传入的 i 值为 1, 因为还是在第一个中间件函数内部, 但是 compose 内部的 index 已经是 3 了, 所以 i &lt; 3, 所以报错了, 可知在一个中间件函数内部不允许多次调用 next 函数.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/21/http请求返回gzip处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/21/http请求返回gzip处理/" itemprop="url">http请求返回gzip处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-21T11:33:49+08:00">
                2019-02-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/21/http请求返回gzip处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/21/http请求返回gzip处理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>引入模块<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const http = require(<span class="string">'http'</span>);</span><br><span class="line">const qs = require(<span class="string">'querystring'</span>)</span><br><span class="line">const zlib = require(<span class="string">'zlib'</span>); ==&gt; 压缩解压数据</span><br></pre></td></tr></table></figure></p>
<p>程序主题<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    hostname: <span class="string">'www.kuaidi100.com'</span>,</span><br><span class="line">    path: <span class="string">'/query?type=yuantong&amp;postid=804233238482357128&amp;temp=0.04453568682858622&amp;phone=123'</span>,</span><br><span class="line">    methos: <span class="string">'GET'</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'Accept'</span>: <span class="string">'*/*'</span>,</span><br><span class="line">        <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>, <span class="comment">//这里设置返回的编码方式 设置其他的会是乱码</span></span><br><span class="line">        <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.8'</span>,</span><br><span class="line">        <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line">        <span class="string">'Content-Encoding'</span>: <span class="string">'gzip'</span>,</span><br><span class="line">        <span class="string">'Vary'</span>: <span class="string">'Accept-Encoding'</span>,</span><br><span class="line">        <span class="string">'Transfer-Encoding'</span>: <span class="string">'chunked'</span>,</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json;charset=utf-8'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http.get(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'STATUS: '</span> + res.statusCode);</span><br><span class="line">    <span class="built_in">console</span>.log(res.headers[<span class="string">'content-encoding'</span>])</span><br><span class="line">    <span class="keyword">var</span> html = [];</span><br><span class="line">    res.on(<span class="string">"data"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        html.push(data);</span><br><span class="line">    &#125;)</span><br><span class="line">    res.on(<span class="string">"end"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> buffer = Buffer.concat(html);</span><br><span class="line">        <span class="comment">// 对返回的数据buffer进行解压操作</span></span><br><span class="line">        zlib.gunzip(buffer, <span class="function"><span class="keyword">function</span>(<span class="params">err, decoded</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(decoded.toString());</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).on(<span class="string">"error"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"获取失败"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/19/mime文件扩展名/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/mime文件扩展名/" itemprop="url">mime文件扩展名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-19T14:17:59+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/19/mime文件扩展名/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/19/mime文件扩展名/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="不同类型文件的mime文件扩展名"><a href="#不同类型文件的mime文件扩展名" class="headerlink" title="不同类型文件的mime文件扩展名:"></a>不同类型文件的mime文件扩展名:</h1><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">".323"</span>: <span class="string">"text/h323"</span>,</span><br><span class="line">    <span class="attr">".3gp"</span>: <span class="string">"video/3gpp"</span>,</span><br><span class="line">    <span class="attr">".aab"</span>: <span class="string">"application/x-authoware-bin"</span>,</span><br><span class="line">    <span class="attr">".aam"</span>: <span class="string">"application/x-authoware-map"</span>,</span><br><span class="line">    <span class="attr">".aas"</span>: <span class="string">"application/x-authoware-seg"</span>,</span><br><span class="line">    <span class="attr">".acx"</span>: <span class="string">"application/internet-property-stream"</span>,</span><br><span class="line">    <span class="attr">".ai"</span>: <span class="string">"application/postscript"</span>,</span><br><span class="line">    <span class="attr">".aif"</span>: <span class="string">"audio/x-aiff"</span>,</span><br><span class="line">    <span class="attr">".aifc"</span>: <span class="string">"audio/x-aiff"</span>,</span><br><span class="line">    <span class="attr">".aiff"</span>: <span class="string">"audio/x-aiff"</span>,</span><br><span class="line">    <span class="attr">".als"</span>: <span class="string">"audio/X-Alpha5"</span>,</span><br><span class="line">    <span class="attr">".amc"</span>: <span class="string">"application/x-mpeg"</span>,</span><br><span class="line">    <span class="attr">".ani"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".apk"</span>: <span class="string">"application/vnd.android.package-archive"</span>,</span><br><span class="line">    <span class="attr">".asc"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".asd"</span>: <span class="string">"application/astound"</span>,</span><br><span class="line">    <span class="attr">".asf"</span>: <span class="string">"video/x-ms-asf"</span>,</span><br><span class="line">    <span class="attr">".asn"</span>: <span class="string">"application/astound"</span>,</span><br><span class="line">    <span class="attr">".asp"</span>: <span class="string">"application/x-asap"</span>,</span><br><span class="line">    <span class="attr">".asr"</span>: <span class="string">"video/x-ms-asf"</span>,</span><br><span class="line">    <span class="attr">".asx"</span>: <span class="string">"video/x-ms-asf"</span>,</span><br><span class="line">    <span class="attr">".au"</span>: <span class="string">"audio/basic"</span>,</span><br><span class="line">    <span class="attr">".avb"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".avi"</span>: <span class="string">"video/x-msvideo"</span>,</span><br><span class="line">    <span class="attr">".awb"</span>: <span class="string">"audio/amr-wb"</span>,</span><br><span class="line">    <span class="attr">".axs"</span>: <span class="string">"application/olescript"</span>,</span><br><span class="line">    <span class="attr">".bas"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".bcpio"</span>: <span class="string">"application/x-bcpio"</span>,</span><br><span class="line">    <span class="attr">".bin "</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".bld"</span>: <span class="string">"application/bld"</span>,</span><br><span class="line">    <span class="attr">".bld2"</span>: <span class="string">"application/bld2"</span>,</span><br><span class="line">    <span class="attr">".bmp"</span>: <span class="string">"image/bmp"</span>,</span><br><span class="line">    <span class="attr">".bpk"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".bz2"</span>: <span class="string">"application/x-bzip2"</span>,</span><br><span class="line">    <span class="attr">".c"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".cal"</span>: <span class="string">"image/x-cals"</span>,</span><br><span class="line">    <span class="attr">".cat"</span>: <span class="string">"application/vnd.ms-pkiseccat"</span>,</span><br><span class="line">    <span class="attr">".ccn"</span>: <span class="string">"application/x-cnc"</span>,</span><br><span class="line">    <span class="attr">".cco"</span>: <span class="string">"application/x-cocoa"</span>,</span><br><span class="line">    <span class="attr">".cdf"</span>: <span class="string">"application/x-cdf"</span>,</span><br><span class="line">    <span class="attr">".cer"</span>: <span class="string">"application/x-x509-ca-cert"</span>,</span><br><span class="line">    <span class="attr">".cgi"</span>: <span class="string">"magnus-internal/cgi"</span>,</span><br><span class="line">    <span class="attr">".chat"</span>: <span class="string">"application/x-chat"</span>,</span><br><span class="line">    <span class="attr">".class"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".clp"</span>: <span class="string">"application/x-msclip"</span>,</span><br><span class="line">    <span class="attr">".cmx"</span>: <span class="string">"image/x-cmx"</span>,</span><br><span class="line">    <span class="attr">".co"</span>: <span class="string">"application/x-cult3d-object"</span>,</span><br><span class="line">    <span class="attr">".cod"</span>: <span class="string">"image/cis-cod"</span>,</span><br><span class="line">    <span class="attr">".conf"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".cpio"</span>: <span class="string">"application/x-cpio"</span>,</span><br><span class="line">    <span class="attr">".cpp"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".cpt"</span>: <span class="string">"application/mac-compactpro"</span>,</span><br><span class="line">    <span class="attr">".crd"</span>: <span class="string">"application/x-mscardfile"</span>,</span><br><span class="line">    <span class="attr">".crl"</span>: <span class="string">"application/pkix-crl"</span>,</span><br><span class="line">    <span class="attr">".crt"</span>: <span class="string">"application/x-x509-ca-cert"</span>,</span><br><span class="line">    <span class="attr">".csh"</span>: <span class="string">"application/x-csh"</span>,</span><br><span class="line">    <span class="attr">".csm"</span>: <span class="string">"chemical/x-csml"</span>,</span><br><span class="line">    <span class="attr">".csml"</span>: <span class="string">"chemical/x-csml"</span>,</span><br><span class="line">    <span class="attr">".css"</span>: <span class="string">"text/css"</span>,</span><br><span class="line">    <span class="attr">".cur"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".dcm"</span>: <span class="string">"x-lml/x-evm"</span>,</span><br><span class="line">    <span class="attr">".dcr"</span>: <span class="string">"application/x-director"</span>,</span><br><span class="line">    <span class="attr">".dcx"</span>: <span class="string">"image/x-dcx"</span>,</span><br><span class="line">    <span class="attr">".der"</span>: <span class="string">"application/x-x509-ca-cert"</span>,</span><br><span class="line">    <span class="attr">".dhtml"</span>: <span class="string">"text/html"</span>,</span><br><span class="line">    <span class="attr">".dir"</span>: <span class="string">"application/x-director"</span>,</span><br><span class="line">    <span class="attr">".dll"</span>: <span class="string">"application/x-msdownload"</span>,</span><br><span class="line">    <span class="attr">".dmg"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".dms"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".doc"</span>: <span class="string">"application/msword"</span>,</span><br><span class="line">    <span class="attr">".docx"</span>: <span class="string">"application/vnd.openxmlformats-officedocument.wordprocessingml.document"</span>,</span><br><span class="line">    <span class="attr">".dot"</span>: <span class="string">"application/msword"</span>,</span><br><span class="line">    <span class="attr">".dvi"</span>: <span class="string">"application/x-dvi"</span>,</span><br><span class="line">    <span class="attr">".dwf"</span>: <span class="string">"drawing/x-dwf"</span>,</span><br><span class="line">    <span class="attr">".dwg"</span>: <span class="string">"application/x-autocad"</span>,</span><br><span class="line">    <span class="attr">".dxf"</span>: <span class="string">"application/x-autocad"</span>,</span><br><span class="line">    <span class="attr">".dxr"</span>: <span class="string">"application/x-director"</span>,</span><br><span class="line">    <span class="attr">".ebk"</span>: <span class="string">"application/x-expandedbook"</span>,</span><br><span class="line">    <span class="attr">".emb"</span>: <span class="string">"chemical/x-embl-dl-nucleotide"</span>,</span><br><span class="line">    <span class="attr">".embl"</span>: <span class="string">"chemical/x-embl-dl-nucleotide"</span>,</span><br><span class="line">    <span class="attr">".eps"</span>: <span class="string">"application/postscript"</span>,</span><br><span class="line">    <span class="attr">".epub"</span>: <span class="string">"application/epub+zip"</span>,</span><br><span class="line">    <span class="attr">".eri"</span>: <span class="string">"image/x-eri"</span>,</span><br><span class="line">    <span class="attr">".es"</span>: <span class="string">"audio/echospeech"</span>,</span><br><span class="line">    <span class="attr">".esl"</span>: <span class="string">"audio/echospeech"</span>,</span><br><span class="line">    <span class="attr">".etc"</span>: <span class="string">"application/x-earthtime"</span>,</span><br><span class="line">    <span class="attr">".etx"</span>: <span class="string">"text/x-setext"</span>,</span><br><span class="line">    <span class="attr">".evm"</span>: <span class="string">"x-lml/x-evm"</span>,</span><br><span class="line">    <span class="attr">".evy"</span>: <span class="string">"application/envoy"</span>,</span><br><span class="line">    <span class="attr">".exe"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".fh4"</span>: <span class="string">"image/x-freehand"</span>,</span><br><span class="line">    <span class="attr">".fh5"</span>: <span class="string">"image/x-freehand"</span>,</span><br><span class="line">    <span class="attr">".fhc"</span>: <span class="string">"image/x-freehand"</span>,</span><br><span class="line">    <span class="attr">".fif"</span>: <span class="string">"application/fractals"</span>,</span><br><span class="line">    <span class="attr">".flr"</span>: <span class="string">"x-world/x-vrml"</span>,</span><br><span class="line">    <span class="attr">".flv"</span>: <span class="string">"flv-application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".fm"</span>: <span class="string">"application/x-maker"</span>,</span><br><span class="line">    <span class="attr">".fpx"</span>: <span class="string">"image/x-fpx"</span>,</span><br><span class="line">    <span class="attr">".fvi"</span>: <span class="string">"video/isivideo"</span>,</span><br><span class="line">    <span class="attr">".gau"</span>: <span class="string">"chemical/x-gaussian-input"</span>,</span><br><span class="line">    <span class="attr">".gca"</span>: <span class="string">"application/x-gca-compressed"</span>,</span><br><span class="line">    <span class="attr">".gdb"</span>: <span class="string">"x-lml/x-gdb"</span>,</span><br><span class="line">    <span class="attr">".gif"</span>: <span class="string">"image/gif"</span>,</span><br><span class="line">    <span class="attr">".gps"</span>: <span class="string">"application/x-gps"</span>,</span><br><span class="line">    <span class="attr">".gtar"</span>: <span class="string">"application/x-gtar"</span>,</span><br><span class="line">    <span class="attr">".gz"</span>: <span class="string">"application/x-gzip"</span>,</span><br><span class="line">    <span class="attr">".h"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".hdf"</span>: <span class="string">"application/x-hdf"</span>,</span><br><span class="line">    <span class="attr">".hdm"</span>: <span class="string">"text/x-hdml"</span>,</span><br><span class="line">    <span class="attr">".hdml"</span>: <span class="string">"text/x-hdml"</span>,</span><br><span class="line">    <span class="attr">".hlp"</span>: <span class="string">"application/winhlp"</span>,</span><br><span class="line">    <span class="attr">".hqx"</span>: <span class="string">"application/mac-binhex40"</span>,</span><br><span class="line">    <span class="attr">".hta"</span>: <span class="string">"application/hta"</span>,</span><br><span class="line">    <span class="attr">".htc"</span>: <span class="string">"text/x-component"</span>,</span><br><span class="line">    <span class="attr">".htm"</span>: <span class="string">"text/html"</span>,</span><br><span class="line">    <span class="attr">".html"</span>: <span class="string">"text/html"</span>,</span><br><span class="line">    <span class="attr">".hts"</span>: <span class="string">"text/html"</span>,</span><br><span class="line">    <span class="attr">".htt"</span>: <span class="string">"text/webviewhtml"</span>,</span><br><span class="line">    <span class="attr">".ice"</span>: <span class="string">"x-conference/x-cooltalk"</span>,</span><br><span class="line">    <span class="attr">".ico"</span>: <span class="string">"image/x-icon"</span>,</span><br><span class="line">    <span class="attr">".ief"</span>: <span class="string">"image/ief"</span>,</span><br><span class="line">    <span class="attr">".ifm"</span>: <span class="string">"image/gif"</span>,</span><br><span class="line">    <span class="attr">".ifs"</span>: <span class="string">"image/ifs"</span>,</span><br><span class="line">    <span class="attr">".iii"</span>: <span class="string">"application/x-iphone"</span>,</span><br><span class="line">    <span class="attr">".imy"</span>: <span class="string">"audio/melody"</span>,</span><br><span class="line">    <span class="attr">".ins"</span>: <span class="string">"application/x-internet-signup"</span>,</span><br><span class="line">    <span class="attr">".ips"</span>: <span class="string">"application/x-ipscript"</span>,</span><br><span class="line">    <span class="attr">".ipx"</span>: <span class="string">"application/x-ipix"</span>,</span><br><span class="line">    <span class="attr">".isp"</span>: <span class="string">"application/x-internet-signup"</span>,</span><br><span class="line">    <span class="attr">".it"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".itz"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".ivr"</span>: <span class="string">"i-world/i-vrml"</span>,</span><br><span class="line">    <span class="attr">".j2k"</span>: <span class="string">"image/j2k"</span>,</span><br><span class="line">    <span class="attr">".jad"</span>: <span class="string">"text/vnd.sun.j2me.app-descriptor"</span>,</span><br><span class="line">    <span class="attr">".jam"</span>: <span class="string">"application/x-jam"</span>,</span><br><span class="line">    <span class="attr">".jar"</span>: <span class="string">"application/java-archive"</span>,</span><br><span class="line">    <span class="attr">".java"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".jfif"</span>: <span class="string">"image/pipeg"</span>,</span><br><span class="line">    <span class="attr">".jnlp"</span>: <span class="string">"application/x-java-jnlp-file"</span>,</span><br><span class="line">    <span class="attr">".jpe"</span>: <span class="string">"image/jpeg"</span>,</span><br><span class="line">    <span class="attr">".jpeg"</span>: <span class="string">"image/jpeg"</span>,</span><br><span class="line">    <span class="attr">".jpg"</span>: <span class="string">"image/jpeg"</span>,</span><br><span class="line">    <span class="attr">".jpz"</span>: <span class="string">"image/jpeg"</span>,</span><br><span class="line">    <span class="attr">".js"</span>: <span class="string">"application/x-javascript"</span>,</span><br><span class="line">    <span class="attr">".jwc"</span>: <span class="string">"application/jwc"</span>,</span><br><span class="line">    <span class="attr">".kjx"</span>: <span class="string">"application/x-kjx"</span>,</span><br><span class="line">    <span class="attr">".lak"</span>: <span class="string">"x-lml/x-lak"</span>,</span><br><span class="line">    <span class="attr">".latex"</span>: <span class="string">"application/x-latex"</span>,</span><br><span class="line">    <span class="attr">".lcc"</span>: <span class="string">"application/fastman"</span>,</span><br><span class="line">    <span class="attr">".lcl"</span>: <span class="string">"application/x-digitalloca"</span>,</span><br><span class="line">    <span class="attr">".lcr"</span>: <span class="string">"application/x-digitalloca"</span>,</span><br><span class="line">    <span class="attr">".lgh"</span>: <span class="string">"application/lgh"</span>,</span><br><span class="line">    <span class="attr">".lha"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".lml"</span>: <span class="string">"x-lml/x-lml"</span>,</span><br><span class="line">    <span class="attr">".lmlpack"</span>: <span class="string">"x-lml/x-lmlpack"</span>,</span><br><span class="line">    <span class="attr">".log"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".lsf"</span>: <span class="string">"video/x-la-asf"</span>,</span><br><span class="line">    <span class="attr">".lsx"</span>: <span class="string">"video/x-la-asf"</span>,</span><br><span class="line">    <span class="attr">".lzh"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".m13"</span>: <span class="string">"application/x-msmediaview"</span>,</span><br><span class="line">    <span class="attr">".m14"</span>: <span class="string">"application/x-msmediaview"</span>,</span><br><span class="line">    <span class="attr">".m15"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".m3u"</span>: <span class="string">"audio/x-mpegurl"</span>,</span><br><span class="line">    <span class="attr">".m3url"</span>: <span class="string">"audio/x-mpegurl"</span>,</span><br><span class="line">    <span class="attr">".m4a"</span>: <span class="string">"audio/mp4a-latm"</span>,</span><br><span class="line">    <span class="attr">".m4b"</span>: <span class="string">"audio/mp4a-latm"</span>,</span><br><span class="line">    <span class="attr">".m4p"</span>: <span class="string">"audio/mp4a-latm"</span>,</span><br><span class="line">    <span class="attr">".m4u"</span>: <span class="string">"video/vnd.mpegurl"</span>,</span><br><span class="line">    <span class="attr">".m4v"</span>: <span class="string">"video/x-m4v"</span>,</span><br><span class="line">    <span class="attr">".ma1"</span>: <span class="string">"audio/ma1"</span>,</span><br><span class="line">    <span class="attr">".ma2"</span>: <span class="string">"audio/ma2"</span>,</span><br><span class="line">    <span class="attr">".ma3"</span>: <span class="string">"audio/ma3"</span>,</span><br><span class="line">    <span class="attr">".ma5"</span>: <span class="string">"audio/ma5"</span>,</span><br><span class="line">    <span class="attr">".man"</span>: <span class="string">"application/x-troff-man"</span>,</span><br><span class="line">    <span class="attr">".map"</span>: <span class="string">"magnus-internal/imagemap"</span>,</span><br><span class="line">    <span class="attr">".mbd"</span>: <span class="string">"application/mbedlet"</span>,</span><br><span class="line">    <span class="attr">".mct"</span>: <span class="string">"application/x-mascot"</span>,</span><br><span class="line">    <span class="attr">".mdb"</span>: <span class="string">"application/x-msaccess"</span>,</span><br><span class="line">    <span class="attr">".mdz"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".me"</span>: <span class="string">"application/x-troff-me"</span>,</span><br><span class="line">    <span class="attr">".mel"</span>: <span class="string">"text/x-vmel"</span>,</span><br><span class="line">    <span class="attr">".mht"</span>: <span class="string">"message/rfc822"</span>,</span><br><span class="line">    <span class="attr">".mhtml"</span>: <span class="string">"message/rfc822"</span>,</span><br><span class="line">    <span class="attr">".mi"</span>: <span class="string">"application/x-mif"</span>,</span><br><span class="line">    <span class="attr">".mid"</span>: <span class="string">"audio/mid"</span>,</span><br><span class="line">    <span class="attr">".midi"</span>: <span class="string">"audio/midi"</span>,</span><br><span class="line">    <span class="attr">".mif"</span>: <span class="string">"application/x-mif"</span>,</span><br><span class="line">    <span class="attr">".mil"</span>: <span class="string">"image/x-cals"</span>,</span><br><span class="line">    <span class="attr">".mio"</span>: <span class="string">"audio/x-mio"</span>,</span><br><span class="line">    <span class="attr">".mmf"</span>: <span class="string">"application/x-skt-lbs"</span>,</span><br><span class="line">    <span class="attr">".mng"</span>: <span class="string">"video/x-mng"</span>,</span><br><span class="line">    <span class="attr">".mny"</span>: <span class="string">"application/x-msmoney"</span>,</span><br><span class="line">    <span class="attr">".moc"</span>: <span class="string">"application/x-mocha"</span>,</span><br><span class="line">    <span class="attr">".mocha"</span>: <span class="string">"application/x-mocha"</span>,</span><br><span class="line">    <span class="attr">".mod"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".mof"</span>: <span class="string">"application/x-yumekara"</span>,</span><br><span class="line">    <span class="attr">".mol"</span>: <span class="string">"chemical/x-mdl-molfile"</span>,</span><br><span class="line">    <span class="attr">".mop"</span>: <span class="string">"chemical/x-mopac-input"</span>,</span><br><span class="line">    <span class="attr">".mov"</span>: <span class="string">"video/quicktime"</span>,</span><br><span class="line">    <span class="attr">".movie"</span>: <span class="string">"video/x-sgi-movie"</span>,</span><br><span class="line">    <span class="attr">".mp2"</span>: <span class="string">"video/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mp3"</span>: <span class="string">"audio/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mp4"</span>: <span class="string">"video/mp4"</span>,</span><br><span class="line">    <span class="attr">".mpa"</span>: <span class="string">"video/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mpc"</span>: <span class="string">"application/vnd.mpohun.certificate"</span>,</span><br><span class="line">    <span class="attr">".mpe"</span>: <span class="string">"video/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mpeg"</span>: <span class="string">"video/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mpg"</span>: <span class="string">"video/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mpg4"</span>: <span class="string">"video/mp4"</span>,</span><br><span class="line">    <span class="attr">".mpga"</span>: <span class="string">"audio/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mpn"</span>: <span class="string">"application/vnd.mophun.application"</span>,</span><br><span class="line">    <span class="attr">".mpp"</span>: <span class="string">"application/vnd.ms-project"</span>,</span><br><span class="line">    <span class="attr">".mps"</span>: <span class="string">"application/x-mapserver"</span>,</span><br><span class="line">    <span class="attr">".mpv2"</span>: <span class="string">"video/mpeg"</span>,</span><br><span class="line">    <span class="attr">".mrl"</span>: <span class="string">"text/x-mrml"</span>,</span><br><span class="line">    <span class="attr">".mrm"</span>: <span class="string">"application/x-mrm"</span>,</span><br><span class="line">    <span class="attr">".ms"</span>: <span class="string">"application/x-troff-ms"</span>,</span><br><span class="line">    <span class="attr">".msg"</span>: <span class="string">"application/vnd.ms-outlook"</span>,</span><br><span class="line">    <span class="attr">".mts"</span>: <span class="string">"application/metastream"</span>,</span><br><span class="line">    <span class="attr">".mtx"</span>: <span class="string">"application/metastream"</span>,</span><br><span class="line">    <span class="attr">".mtz"</span>: <span class="string">"application/metastream"</span>,</span><br><span class="line">    <span class="attr">".mvb"</span>: <span class="string">"application/x-msmediaview"</span>,</span><br><span class="line">    <span class="attr">".mzv"</span>: <span class="string">"application/metastream"</span>,</span><br><span class="line">    <span class="attr">".nar"</span>: <span class="string">"application/zip"</span>,</span><br><span class="line">    <span class="attr">".nbmp"</span>: <span class="string">"image/nbmp"</span>,</span><br><span class="line">    <span class="attr">".nc"</span>: <span class="string">"application/x-netcdf"</span>,</span><br><span class="line">    <span class="attr">".ndb"</span>: <span class="string">"x-lml/x-ndb"</span>,</span><br><span class="line">    <span class="attr">".ndwn"</span>: <span class="string">"application/ndwn"</span>,</span><br><span class="line">    <span class="attr">".nif"</span>: <span class="string">"application/x-nif"</span>,</span><br><span class="line">    <span class="attr">".nmz"</span>: <span class="string">"application/x-scream"</span>,</span><br><span class="line">    <span class="attr">".nokia-op-logo"</span>: <span class="string">"image/vnd.nok-oplogo-color"</span>,</span><br><span class="line">    <span class="attr">".npx"</span>: <span class="string">"application/x-netfpx"</span>,</span><br><span class="line">    <span class="attr">".nsnd"</span>: <span class="string">"audio/nsnd"</span>,</span><br><span class="line">    <span class="attr">".nva"</span>: <span class="string">"application/x-neva1"</span>,</span><br><span class="line">    <span class="attr">".nws"</span>: <span class="string">"message/rfc822"</span>,</span><br><span class="line">    <span class="attr">".oda"</span>: <span class="string">"application/oda"</span>,</span><br><span class="line">    <span class="attr">".ogg"</span>: <span class="string">"audio/ogg"</span>,</span><br><span class="line">    <span class="attr">".oom"</span>: <span class="string">"application/x-AtlasMate-Plugin"</span>,</span><br><span class="line">    <span class="attr">".p10"</span>: <span class="string">"application/pkcs10"</span>,</span><br><span class="line">    <span class="attr">".p12"</span>: <span class="string">"application/x-pkcs12"</span>,</span><br><span class="line">    <span class="attr">".p7b"</span>: <span class="string">"application/x-pkcs7-certificates"</span>,</span><br><span class="line">    <span class="attr">".p7c"</span>: <span class="string">"application/x-pkcs7-mime"</span>,</span><br><span class="line">    <span class="attr">".p7m"</span>: <span class="string">"application/x-pkcs7-mime"</span>,</span><br><span class="line">    <span class="attr">".p7r"</span>: <span class="string">"application/x-pkcs7-certreqresp"</span>,</span><br><span class="line">    <span class="attr">".p7s"</span>: <span class="string">"application/x-pkcs7-signature"</span>,</span><br><span class="line">    <span class="attr">".pac"</span>: <span class="string">"audio/x-pac"</span>,</span><br><span class="line">    <span class="attr">".pae"</span>: <span class="string">"audio/x-epac"</span>,</span><br><span class="line">    <span class="attr">".pan"</span>: <span class="string">"application/x-pan"</span>,</span><br><span class="line">    <span class="attr">".pbm"</span>: <span class="string">"image/x-portable-bitmap"</span>,</span><br><span class="line">    <span class="attr">".pcx"</span>: <span class="string">"image/x-pcx"</span>,</span><br><span class="line">    <span class="attr">".pda"</span>: <span class="string">"image/x-pda"</span>,</span><br><span class="line">    <span class="attr">".pdb"</span>: <span class="string">"chemical/x-pdb"</span>,</span><br><span class="line">    <span class="attr">".pdf"</span>: <span class="string">"application/pdf"</span>,</span><br><span class="line">    <span class="attr">".pfr"</span>: <span class="string">"application/font-tdpfr"</span>,</span><br><span class="line">    <span class="attr">".pfx"</span>: <span class="string">"application/x-pkcs12"</span>,</span><br><span class="line">    <span class="attr">".pgm"</span>: <span class="string">"image/x-portable-graymap"</span>,</span><br><span class="line">    <span class="attr">".pict"</span>: <span class="string">"image/x-pict"</span>,</span><br><span class="line">    <span class="attr">".pko"</span>: <span class="string">"application/ynd.ms-pkipko"</span>,</span><br><span class="line">    <span class="attr">".pm"</span>: <span class="string">"application/x-perl"</span>,</span><br><span class="line">    <span class="attr">".pma"</span>: <span class="string">"application/x-perfmon"</span>,</span><br><span class="line">    <span class="attr">".pmc"</span>: <span class="string">"application/x-perfmon"</span>,</span><br><span class="line">    <span class="attr">".pmd"</span>: <span class="string">"application/x-pmd"</span>,</span><br><span class="line">    <span class="attr">".pml"</span>: <span class="string">"application/x-perfmon"</span>,</span><br><span class="line">    <span class="attr">".pmr"</span>: <span class="string">"application/x-perfmon"</span>,</span><br><span class="line">    <span class="attr">".pmw"</span>: <span class="string">"application/x-perfmon"</span>,</span><br><span class="line">    <span class="attr">".png"</span>: <span class="string">"image/png"</span>,</span><br><span class="line">    <span class="attr">".pnm"</span>: <span class="string">"image/x-portable-anymap"</span>,</span><br><span class="line">    <span class="attr">".pnz"</span>: <span class="string">"image/png"</span>,</span><br><span class="line">    <span class="attr">".pot,"</span>: <span class="string">"application/vnd.ms-powerpoint"</span>,</span><br><span class="line">    <span class="attr">".ppm"</span>: <span class="string">"image/x-portable-pixmap"</span>,</span><br><span class="line">    <span class="attr">".pps"</span>: <span class="string">"application/vnd.ms-powerpoint"</span>,</span><br><span class="line">    <span class="attr">".ppt"</span>: <span class="string">"application/vnd.ms-powerpoint"</span>,</span><br><span class="line">    <span class="attr">".pptx"</span>: <span class="string">"application/vnd.openxmlformats-officedocument.presentationml.presentation"</span>,</span><br><span class="line">    <span class="attr">".pqf"</span>: <span class="string">"application/x-cprplayer"</span>,</span><br><span class="line">    <span class="attr">".pqi"</span>: <span class="string">"application/cprplayer"</span>,</span><br><span class="line">    <span class="attr">".prc"</span>: <span class="string">"application/x-prc"</span>,</span><br><span class="line">    <span class="attr">".prf"</span>: <span class="string">"application/pics-rules"</span>,</span><br><span class="line">    <span class="attr">".prop"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".proxy"</span>: <span class="string">"application/x-ns-proxy-autoconfig"</span>,</span><br><span class="line">    <span class="attr">".ps"</span>: <span class="string">"application/postscript"</span>,</span><br><span class="line">    <span class="attr">".ptlk"</span>: <span class="string">"application/listenup"</span>,</span><br><span class="line">    <span class="attr">".pub"</span>: <span class="string">"application/x-mspublisher"</span>,</span><br><span class="line">    <span class="attr">".pvx"</span>: <span class="string">"video/x-pv-pvx"</span>,</span><br><span class="line">    <span class="attr">".qcp"</span>: <span class="string">"audio/vnd.qcelp"</span>,</span><br><span class="line">    <span class="attr">".qt"</span>: <span class="string">"video/quicktime"</span>,</span><br><span class="line">    <span class="attr">".qti"</span>: <span class="string">"image/x-quicktime"</span>,</span><br><span class="line">    <span class="attr">".qtif"</span>: <span class="string">"image/x-quicktime"</span>,</span><br><span class="line">    <span class="attr">".r3t"</span>: <span class="string">"text/vnd.rn-realtext3d"</span>,</span><br><span class="line">    <span class="attr">".ra"</span>: <span class="string">"audio/x-pn-realaudio"</span>,</span><br><span class="line">    <span class="attr">".ram"</span>: <span class="string">"audio/x-pn-realaudio"</span>,</span><br><span class="line">    <span class="attr">".rar"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".ras"</span>: <span class="string">"image/x-cmu-raster"</span>,</span><br><span class="line">    <span class="attr">".rc"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".rdf"</span>: <span class="string">"application/rdf+xml"</span>,</span><br><span class="line">    <span class="attr">".rf"</span>: <span class="string">"image/vnd.rn-realflash"</span>,</span><br><span class="line">    <span class="attr">".rgb"</span>: <span class="string">"image/x-rgb"</span>,</span><br><span class="line">    <span class="attr">".rlf"</span>: <span class="string">"application/x-richlink"</span>,</span><br><span class="line">    <span class="attr">".rm"</span>: <span class="string">"audio/x-pn-realaudio"</span>,</span><br><span class="line">    <span class="attr">".rmf"</span>: <span class="string">"audio/x-rmf"</span>,</span><br><span class="line">    <span class="attr">".rmi"</span>: <span class="string">"audio/mid"</span>,</span><br><span class="line">    <span class="attr">".rmm"</span>: <span class="string">"audio/x-pn-realaudio"</span>,</span><br><span class="line">    <span class="attr">".rmvb"</span>: <span class="string">"audio/x-pn-realaudio"</span>,</span><br><span class="line">    <span class="attr">".rnx"</span>: <span class="string">"application/vnd.rn-realplayer"</span>,</span><br><span class="line">    <span class="attr">".roff"</span>: <span class="string">"application/x-troff"</span>,</span><br><span class="line">    <span class="attr">".rp"</span>: <span class="string">"image/vnd.rn-realpix"</span>,</span><br><span class="line">    <span class="attr">".rpm"</span>: <span class="string">"audio/x-pn-realaudio-plugin"</span>,</span><br><span class="line">    <span class="attr">".rt"</span>: <span class="string">"text/vnd.rn-realtext"</span>,</span><br><span class="line">    <span class="attr">".rte"</span>: <span class="string">"x-lml/x-gps"</span>,</span><br><span class="line">    <span class="attr">".rtf"</span>: <span class="string">"application/rtf"</span>,</span><br><span class="line">    <span class="attr">".rtg"</span>: <span class="string">"application/metastream"</span>,</span><br><span class="line">    <span class="attr">".rtx"</span>: <span class="string">"text/richtext"</span>,</span><br><span class="line">    <span class="attr">".rv"</span>: <span class="string">"video/vnd.rn-realvideo"</span>,</span><br><span class="line">    <span class="attr">".rwc"</span>: <span class="string">"application/x-rogerwilco"</span>,</span><br><span class="line">    <span class="attr">".s3m"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".s3z"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".sca"</span>: <span class="string">"application/x-supercard"</span>,</span><br><span class="line">    <span class="attr">".scd"</span>: <span class="string">"application/x-msschedule"</span>,</span><br><span class="line">    <span class="attr">".sct"</span>: <span class="string">"text/scriptlet"</span>,</span><br><span class="line">    <span class="attr">".sdf"</span>: <span class="string">"application/e-score"</span>,</span><br><span class="line">    <span class="attr">".sea"</span>: <span class="string">"application/x-stuffit"</span>,</span><br><span class="line">    <span class="attr">".setpay"</span>: <span class="string">"application/set-payment-initiation"</span>,</span><br><span class="line">    <span class="attr">".setreg"</span>: <span class="string">"application/set-registration-initiation"</span>,</span><br><span class="line">    <span class="attr">".sgm"</span>: <span class="string">"text/x-sgml"</span>,</span><br><span class="line">    <span class="attr">".sgml"</span>: <span class="string">"text/x-sgml"</span>,</span><br><span class="line">    <span class="attr">".sh"</span>: <span class="string">"application/x-sh"</span>,</span><br><span class="line">    <span class="attr">".shar"</span>: <span class="string">"application/x-shar"</span>,</span><br><span class="line">    <span class="attr">".shtml"</span>: <span class="string">"magnus-internal/parsed-html"</span>,</span><br><span class="line">    <span class="attr">".shw"</span>: <span class="string">"application/presentations"</span>,</span><br><span class="line">    <span class="attr">".si6"</span>: <span class="string">"image/si6"</span>,</span><br><span class="line">    <span class="attr">".si7"</span>: <span class="string">"image/vnd.stiwap.sis"</span>,</span><br><span class="line">    <span class="attr">".si9"</span>: <span class="string">"image/vnd.lgtwap.sis"</span>,</span><br><span class="line">    <span class="attr">".sis"</span>: <span class="string">"application/vnd.symbian.install"</span>,</span><br><span class="line">    <span class="attr">".sit"</span>: <span class="string">"application/x-stuffit"</span>,</span><br><span class="line">    <span class="attr">".skd"</span>: <span class="string">"application/x-Koan"</span>,</span><br><span class="line">    <span class="attr">".skm"</span>: <span class="string">"application/x-Koan"</span>,</span><br><span class="line">    <span class="attr">".skp"</span>: <span class="string">"application/x-Koan"</span>,</span><br><span class="line">    <span class="attr">".skt"</span>: <span class="string">"application/x-Koan"</span>,</span><br><span class="line">    <span class="attr">".slc"</span>: <span class="string">"application/x-salsa"</span>,</span><br><span class="line">    <span class="attr">".smd"</span>: <span class="string">"audio/x-smd"</span>,</span><br><span class="line">    <span class="attr">".smi"</span>: <span class="string">"application/smil"</span>,</span><br><span class="line">    <span class="attr">".smil"</span>: <span class="string">"application/smil"</span>,</span><br><span class="line">    <span class="attr">".smp"</span>: <span class="string">"application/studiom"</span>,</span><br><span class="line">    <span class="attr">".smz"</span>: <span class="string">"audio/x-smd"</span>,</span><br><span class="line">    <span class="attr">".snd"</span>: <span class="string">"audio/basic"</span>,</span><br><span class="line">    <span class="attr">".spc"</span>: <span class="string">"application/x-pkcs7-certificates"</span>,</span><br><span class="line">    <span class="attr">".spl"</span>: <span class="string">"application/futuresplash"</span>,</span><br><span class="line">    <span class="attr">".spr"</span>: <span class="string">"application/x-sprite"</span>,</span><br><span class="line">    <span class="attr">".sprite"</span>: <span class="string">"application/x-sprite"</span>,</span><br><span class="line">    <span class="attr">".sdp"</span>: <span class="string">"application/sdp"</span>,</span><br><span class="line">    <span class="attr">".spt"</span>: <span class="string">"application/x-spt"</span>,</span><br><span class="line">    <span class="attr">".src"</span>: <span class="string">"application/x-wais-source"</span>,</span><br><span class="line">    <span class="attr">".sst"</span>: <span class="string">"application/vnd.ms-pkicertstore"</span>,</span><br><span class="line">    <span class="attr">".stk"</span>: <span class="string">"application/hyperstudio"</span>,</span><br><span class="line">    <span class="attr">".stl"</span>: <span class="string">"application/vnd.ms-pkistl"</span>,</span><br><span class="line">    <span class="attr">".stm"</span>: <span class="string">"text/html"</span>,</span><br><span class="line">    <span class="attr">".svg"</span>: <span class="string">"image/svg+xml"</span>,</span><br><span class="line">    <span class="attr">".sv4cpio"</span>: <span class="string">"application/x-sv4cpio"</span>,</span><br><span class="line">    <span class="attr">".sv4crc"</span>: <span class="string">"application/x-sv4crc"</span>,</span><br><span class="line">    <span class="attr">".svf"</span>: <span class="string">"image/vnd"</span>,</span><br><span class="line">    <span class="attr">".svg"</span>: <span class="string">"image/svg+xml"</span>,</span><br><span class="line">    <span class="attr">".svh"</span>: <span class="string">"image/svh"</span>,</span><br><span class="line">    <span class="attr">".svr"</span>: <span class="string">"x-world/x-svr"</span>,</span><br><span class="line">    <span class="attr">".swf"</span>: <span class="string">"application/x-shockwave-flash"</span>,</span><br><span class="line">    <span class="attr">".swfl"</span>: <span class="string">"application/x-shockwave-flash"</span>,</span><br><span class="line">    <span class="attr">".t"</span>: <span class="string">"application/x-troff"</span>,</span><br><span class="line">    <span class="attr">".tad"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".talk"</span>: <span class="string">"text/x-speech"</span>,</span><br><span class="line">    <span class="attr">".tar"</span>: <span class="string">"application/x-tar"</span>,</span><br><span class="line">    <span class="attr">".taz"</span>: <span class="string">"application/x-tar"</span>,</span><br><span class="line">    <span class="attr">".tbp"</span>: <span class="string">"application/x-timbuktu"</span>,</span><br><span class="line">    <span class="attr">".tbt"</span>: <span class="string">"application/x-timbuktu"</span>,</span><br><span class="line">    <span class="attr">".tcl"</span>: <span class="string">"application/x-tcl"</span>,</span><br><span class="line">    <span class="attr">".tex"</span>: <span class="string">"application/x-tex"</span>,</span><br><span class="line">    <span class="attr">".texi"</span>: <span class="string">"application/x-texinfo"</span>,</span><br><span class="line">    <span class="attr">".texinfo"</span>: <span class="string">"application/x-texinfo"</span>,</span><br><span class="line">    <span class="attr">".tgz"</span>: <span class="string">"application/x-compressed"</span>,</span><br><span class="line">    <span class="attr">".thm"</span>: <span class="string">"application/vnd.eri.thm"</span>,</span><br><span class="line">    <span class="attr">".tif"</span>: <span class="string">"image/tiff"</span>,</span><br><span class="line">    <span class="attr">".tiff"</span>: <span class="string">"image/tiff"</span>,</span><br><span class="line">    <span class="attr">".tki"</span>: <span class="string">"application/x-tkined"</span>,</span><br><span class="line">    <span class="attr">".tkined"</span>: <span class="string">"application/x-tkined"</span>,</span><br><span class="line">    <span class="attr">".toc"</span>: <span class="string">"application/toc"</span>,</span><br><span class="line">    <span class="attr">".toy"</span>: <span class="string">"image/toy"</span>,</span><br><span class="line">    <span class="attr">".tr"</span>: <span class="string">"application/x-troff"</span>,</span><br><span class="line">    <span class="attr">".trk"</span>: <span class="string">"x-lml/x-gps"</span>,</span><br><span class="line">    <span class="attr">".trm"</span>: <span class="string">"application/x-msterminal"</span>,</span><br><span class="line">    <span class="attr">".tsi"</span>: <span class="string">"audio/tsplayer"</span>,</span><br><span class="line">    <span class="attr">".tsp"</span>: <span class="string">"application/dsptype"</span>,</span><br><span class="line">    <span class="attr">".tsv"</span>: <span class="string">"text/tab-separated-values"</span>,</span><br><span class="line">    <span class="attr">".ttf"</span>: <span class="string">"application/octet-stream"</span>,</span><br><span class="line">    <span class="attr">".ttz"</span>: <span class="string">"application/t-time"</span>,</span><br><span class="line">    <span class="attr">".txt"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".uls"</span>: <span class="string">"text/iuls"</span>,</span><br><span class="line">    <span class="attr">".ult"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".ustar"</span>: <span class="string">"application/x-ustar"</span>,</span><br><span class="line">    <span class="attr">".uu"</span>: <span class="string">"application/x-uuencode"</span>,</span><br><span class="line">    <span class="attr">".uue"</span>: <span class="string">"application/x-uuencode"</span>,</span><br><span class="line">    <span class="attr">".vcd"</span>: <span class="string">"application/x-cdlink"</span>,</span><br><span class="line">    <span class="attr">".vcf"</span>: <span class="string">"text/x-vcard"</span>,</span><br><span class="line">    <span class="attr">".vdo"</span>: <span class="string">"video/vdo"</span>,</span><br><span class="line">    <span class="attr">".vib"</span>: <span class="string">"audio/vib"</span>,</span><br><span class="line">    <span class="attr">".viv"</span>: <span class="string">"video/vivo"</span>,</span><br><span class="line">    <span class="attr">".vivo"</span>: <span class="string">"video/vivo"</span>,</span><br><span class="line">    <span class="attr">".vmd"</span>: <span class="string">"application/vocaltec-media-desc"</span>,</span><br><span class="line">    <span class="attr">".vmf"</span>: <span class="string">"application/vocaltec-media-file"</span>,</span><br><span class="line">    <span class="attr">".vmi"</span>: <span class="string">"application/x-dreamcast-vms-info"</span>,</span><br><span class="line">    <span class="attr">".vms"</span>: <span class="string">"application/x-dreamcast-vms"</span>,</span><br><span class="line">    <span class="attr">".vox"</span>: <span class="string">"audio/voxware"</span>,</span><br><span class="line">    <span class="attr">".vqe"</span>: <span class="string">"audio/x-twinvq-plugin"</span>,</span><br><span class="line">    <span class="attr">".vqf"</span>: <span class="string">"audio/x-twinvq"</span>,</span><br><span class="line">    <span class="attr">".vql"</span>: <span class="string">"audio/x-twinvq"</span>,</span><br><span class="line">    <span class="attr">".vre"</span>: <span class="string">"x-world/x-vream"</span>,</span><br><span class="line">    <span class="attr">".vrml"</span>: <span class="string">"x-world/x-vrml"</span>,</span><br><span class="line">    <span class="attr">".vrt"</span>: <span class="string">"x-world/x-vrt"</span>,</span><br><span class="line">    <span class="attr">".vrw"</span>: <span class="string">"x-world/x-vream"</span>,</span><br><span class="line">    <span class="attr">".vts"</span>: <span class="string">"workbook/formulaone"</span>,</span><br><span class="line">    <span class="attr">".wav"</span>: <span class="string">"audio/x-wav"</span>,</span><br><span class="line">    <span class="attr">".wax"</span>: <span class="string">"audio/x-ms-wax"</span>,</span><br><span class="line">    <span class="attr">".wbmp"</span>: <span class="string">"image/vnd.wap.wbmp"</span>,</span><br><span class="line">    <span class="attr">".wcm"</span>: <span class="string">"application/vnd.ms-works"</span>,</span><br><span class="line">    <span class="attr">".wdb"</span>: <span class="string">"application/vnd.ms-works"</span>,</span><br><span class="line">    <span class="attr">".web"</span>: <span class="string">"application/vnd.xara"</span>,</span><br><span class="line">    <span class="attr">".wi"</span>: <span class="string">"image/wavelet"</span>,</span><br><span class="line">    <span class="attr">".wis"</span>: <span class="string">"application/x-InstallShield"</span>,</span><br><span class="line">    <span class="attr">".wks"</span>: <span class="string">"application/vnd.ms-works"</span>,</span><br><span class="line">    <span class="attr">".wm"</span>: <span class="string">"video/x-ms-wm"</span>,</span><br><span class="line">    <span class="attr">".wma"</span>: <span class="string">"audio/x-ms-wma"</span>,</span><br><span class="line">    <span class="attr">".wmd"</span>: <span class="string">"application/x-ms-wmd"</span>,</span><br><span class="line">    <span class="attr">".wmf"</span>: <span class="string">"application/x-msmetafile"</span>,</span><br><span class="line">    <span class="attr">".wml"</span>: <span class="string">"text/vnd.wap.wml"</span>,</span><br><span class="line">    <span class="attr">".wmlc"</span>: <span class="string">"application/vnd.wap.wmlc"</span>,</span><br><span class="line">    <span class="attr">".wmls"</span>: <span class="string">"text/vnd.wap.wmlscript"</span>,</span><br><span class="line">    <span class="attr">".wmlsc"</span>: <span class="string">"application/vnd.wap.wmlscriptc"</span>,</span><br><span class="line">    <span class="attr">".wmlscript"</span>: <span class="string">"text/vnd.wap.wmlscript"</span>,</span><br><span class="line">    <span class="attr">".wmv"</span>: <span class="string">"audio/x-ms-wmv"</span>,</span><br><span class="line">    <span class="attr">".wmx"</span>: <span class="string">"video/x-ms-wmx"</span>,</span><br><span class="line">    <span class="attr">".wmz"</span>: <span class="string">"application/x-ms-wmz"</span>,</span><br><span class="line">    <span class="attr">".wpng"</span>: <span class="string">"image/x-up-wpng"</span>,</span><br><span class="line">    <span class="attr">".wps"</span>: <span class="string">"application/vnd.ms-works"</span>,</span><br><span class="line">    <span class="attr">".wpt"</span>: <span class="string">"x-lml/x-gps"</span>,</span><br><span class="line">    <span class="attr">".wri"</span>: <span class="string">"application/x-mswrite"</span>,</span><br><span class="line">    <span class="attr">".wrl"</span>: <span class="string">"x-world/x-vrml"</span>,</span><br><span class="line">    <span class="attr">".wrz"</span>: <span class="string">"x-world/x-vrml"</span>,</span><br><span class="line">    <span class="attr">".ws"</span>: <span class="string">"text/vnd.wap.wmlscript"</span>,</span><br><span class="line">    <span class="attr">".wsc"</span>: <span class="string">"application/vnd.wap.wmlscriptc"</span>,</span><br><span class="line">    <span class="attr">".wv"</span>: <span class="string">"video/wavelet"</span>,</span><br><span class="line">    <span class="attr">".wvx"</span>: <span class="string">"video/x-ms-wvx"</span>,</span><br><span class="line">    <span class="attr">".wxl"</span>: <span class="string">"application/x-wxl"</span>,</span><br><span class="line">    <span class="attr">".x-gzip"</span>: <span class="string">"application/x-gzip"</span>,</span><br><span class="line">    <span class="attr">".xaf"</span>: <span class="string">"x-world/x-vrml"</span>,</span><br><span class="line">    <span class="attr">".xar"</span>: <span class="string">"application/vnd.xara"</span>,</span><br><span class="line">    <span class="attr">".xbm"</span>: <span class="string">"image/x-xbitmap"</span>,</span><br><span class="line">    <span class="attr">".xdm"</span>: <span class="string">"application/x-xdma"</span>,</span><br><span class="line">    <span class="attr">".xdma"</span>: <span class="string">"application/x-xdma"</span>,</span><br><span class="line">    <span class="attr">".xdw"</span>: <span class="string">"application/vnd.fujixerox.docuworks"</span>,</span><br><span class="line">    <span class="attr">".xht"</span>: <span class="string">"application/xhtml+xml"</span>,</span><br><span class="line">    <span class="attr">".xhtm"</span>: <span class="string">"application/xhtml+xml"</span>,</span><br><span class="line">    <span class="attr">".xhtml"</span>: <span class="string">"application/xhtml+xml"</span>,</span><br><span class="line">    <span class="attr">".xla"</span>: <span class="string">"application/vnd.ms-excel"</span>,</span><br><span class="line">    <span class="attr">".xlc"</span>: <span class="string">"application/vnd.ms-excel"</span>,</span><br><span class="line">    <span class="attr">".xll"</span>: <span class="string">"application/x-excel"</span>,</span><br><span class="line">    <span class="attr">".xlm"</span>: <span class="string">"application/vnd.ms-excel"</span>,</span><br><span class="line">    <span class="attr">".xls"</span>: <span class="string">"application/vnd.ms-excel"</span>,</span><br><span class="line">    <span class="attr">".xlsx"</span>: <span class="string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"</span>,</span><br><span class="line">    <span class="attr">".xlt"</span>: <span class="string">"application/vnd.ms-excel"</span>,</span><br><span class="line">    <span class="attr">".xlw"</span>: <span class="string">"application/vnd.ms-excel"</span>,</span><br><span class="line">    <span class="attr">".xm"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".xml"</span>: <span class="string">"text/plain"</span>,</span><br><span class="line">    <span class="attr">".xml"</span>: <span class="string">"application/xml"</span>,</span><br><span class="line">    <span class="attr">".xmz"</span>: <span class="string">"audio/x-mod"</span>,</span><br><span class="line">    <span class="attr">".xof"</span>: <span class="string">"x-world/x-vrml"</span>,</span><br><span class="line">    <span class="attr">".xpi"</span>: <span class="string">"application/x-xpinstall"</span>,</span><br><span class="line">    <span class="attr">".xpm"</span>: <span class="string">"image/x-xpixmap"</span>,</span><br><span class="line">    <span class="attr">".xsit"</span>: <span class="string">"text/xml"</span>,</span><br><span class="line">    <span class="attr">".xsl"</span>: <span class="string">"text/xml"</span>,</span><br><span class="line">    <span class="attr">".xul"</span>: <span class="string">"text/xul"</span>,</span><br><span class="line">    <span class="attr">".xwd"</span>: <span class="string">"image/x-xwindowdump"</span>,</span><br><span class="line">    <span class="attr">".xyz"</span>: <span class="string">"chemical/x-pdb"</span>,</span><br><span class="line">    <span class="attr">".yz1"</span>: <span class="string">"application/x-yz1"</span>,</span><br><span class="line">    <span class="attr">".z"</span>: <span class="string">"application/x-compress"</span>,</span><br><span class="line">    <span class="attr">".zac"</span>: <span class="string">"application/x-zaurus-zac"</span>,</span><br><span class="line">    <span class="attr">".zip"</span>: <span class="string">"application/zip"</span>,</span><br><span class="line">    <span class="attr">".json"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/19/linux命令大全/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/linux命令大全/" itemprop="url">linux命令大全</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-19T14:09:37+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/19/linux命令大全/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/19/linux命令大全/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作:"></a>基础操作:</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">clear/<span class="built_in">command</span>+k/ctrl+l 清屏</span><br><span class="line">ctrl+u/ctrl+k 删除当前光标位置前/后的内容</span><br><span class="line">ctrl<span class="_">-a</span>:把光标移动到命令行最开始的地方.</span><br><span class="line">ctrl<span class="_">-e</span>:把光标移动到命令行末尾.</span><br><span class="line">ctrl-u:清除命令行中光标所处位置之前的所有字符.</span><br><span class="line">ctrl-k:清除从提示符所在位置到行末尾之间的字符</span><br><span class="line">ctrl-w:清除左边的字段,根据空格做分割来删除的</span><br><span class="line">ctrl-y:将会贴上被ctrl-u 或者 ctrl-k 或者 ctrl-w清除的部分.</span><br><span class="line">ctrl-r:将自动在命令历史缓存中增量搜索后面入的字符.(只是搜索离当前时间最近的一次)</span><br><span class="line">tab:命令行自动补全－自动补全当前的命令行.如果启用自动补全脚本命令参数和选项也可以自动补齐.</span><br><span class="line">ctrl<span class="_">-l</span>:清屏</span><br></pre></td></tr></table></figure>
<h1 id="ls命令"><a href="#ls命令" class="headerlink" title="ls命令:"></a>ls命令:</h1><p>列出目标目录中所有的子目录和文件:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">格式:ls [选项] [目录名]</span><br><span class="line">-a 用于显示所有文件和子目录(保罗点文件).</span><br><span class="line">-l 除了文件名之外,还将文件的权限、所有者、文件大小等信息详细列出来.</span><br><span class="line">-r 将目录的内容清单以英文字母顺序的逆序显示.</span><br><span class="line">-t 按文件修改时间进行排序,而不是按文件名进行排序.</span><br><span class="line">-A 同-a,但不列出“.<span class="string">"(表示当前目录)和“.."</span>(表示当前目录的父目录).</span><br><span class="line">-F 在列出的文件名和目录名后添加标志.例如,在可执行文件后添加“*<span class="string">",在目录名后添加“/"</span>以区分不同的类型.</span><br><span class="line">-R 如果目标目录及其子目录中有文件,就列出所有的文件.</span><br><span class="line"></span><br><span class="line">ls -l filename:单独的列出filename文件信息</span><br><span class="line">ls -l *.py:列出以.py文件格式的文件</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/19/vim最常用命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/vim最常用命令/" itemprop="url">vim最常用命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-19T14:06:35+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/19/vim最常用命令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/19/vim最常用命令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">:<span class="built_in">set</span> nu ==&gt; 显示行数</span><br><span class="line">:<span class="built_in">set</span> nonu ==&gt; 取消显示行数</span><br><span class="line">dd ==&gt; 删除光标所在行</span><br><span class="line">yy ==&gt; 复制光标所在行,然后按下p进行粘贴</span><br><span class="line">/PATTERN ==&gt; 查找,n 下一个,N 上一个</span><br><span class="line">gg ==&gt; 回到第一行</span><br><span class="line">G ==&gt; 到文末</span><br><span class="line">n+ ==&gt; 光标下移几行</span><br><span class="line">n- ==&gt; 光标上移几行</span><br><span class="line">nG ==&gt; 光标移至第n行行首</span><br><span class="line">u ==&gt; 撤消前一次的编辑操作,ctrl+r ==&gt; 恢复之前动作</span><br><span class="line">0或^ ==&gt; 跳转到行首</span><br><span class="line">$ ==&gt; 跳转到行末</span><br><span class="line">Ctrl+f ==&gt; 向下翻一屏	</span><br><span class="line">Ctrl+b ==&gt; 向上翻一屏</span><br><span class="line">d$ ==&gt; 删除光标到行末</span><br><span class="line">d0或y^ ==&gt; 删除光标到行首</span><br><span class="line">n1,n2 d ==&gt; 删除光标到行首</span><br><span class="line">nyy ==&gt; 复制光标所在行和以下的n行,然后按下p进行粘贴</span><br><span class="line">y$ ==&gt; 复制光标到行末尾,然后按下p进行粘贴</span><br><span class="line">y0或y^ ==&gt; 复制光标到行首,然后按下p进行粘贴</span><br><span class="line">:%s/old/new/g ==&gt; 在整个文件范围内替换所有的字符串<span class="string">"old"</span>为<span class="string">"new"</span></span><br><span class="line">:s/old/new ==&gt; 将当前行中查找到的第一个字符<span class="string">"old"</span> 串替换为<span class="string">"new"</span></span><br><span class="line">:s/old/new/g ==&gt; 将当前行中查找到的所有字符串<span class="string">"old"</span> 替换为<span class="string">"new"</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/19/js代码进行兼容性编译/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/19/js代码进行兼容性编译/" itemprop="url">js代码进行兼容性编译</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-19T11:17:11+08:00">
                2019-02-19
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/19/js代码进行兼容性编译/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/19/js代码进行兼容性编译/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、配置文件-babelrc"><a href="#一、配置文件-babelrc" class="headerlink" title="一、配置文件.babelrc"></a>一、配置文件.babelrc</h1><h2 id="在项目根目录下创建一个-babelrc文件-写入以下内容"><a href="#在项目根目录下创建一个-babelrc文件-写入以下内容" class="headerlink" title="在项目根目录下创建一个.babelrc文件,写入以下内容:"></a>在项目根目录下创建一个<code>.babelrc</code>文件,写入以下内容:</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [],</span><br><span class="line">  <span class="attr">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="安装对应的转码规则"><a href="#安装对应的转码规则" class="headerlink" title="安装对应的转码规则:"></a>安装对应的转码规则:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ES2015转码规则</span></span><br><span class="line">$ npm install --save-dev babel-preset-es2015</span><br><span class="line"></span><br><span class="line"><span class="comment"># react转码规则</span></span><br><span class="line">$ npm install --save-dev babel-preset-react</span><br><span class="line"></span><br><span class="line"><span class="comment"># ES7不同阶段语法提案的转码规则(共有4个阶段),选装一个</span></span><br><span class="line">$ npm install --save-dev babel-preset-stage-0  // 包含了async,await等</span><br><span class="line">$ npm install --save-dev babel-preset-stage-1</span><br><span class="line">$ npm install --save-dev babel-preset-stage-2</span><br><span class="line">$ npm install --save-dev babel-preset-stage-3</span><br><span class="line"></span><br><span class="line">将代码转化为 ES6</span><br><span class="line"><span class="string">'babel-preset-es2016'</span> 将ES2016转化成ES6,</span><br><span class="line"><span class="string">'babel-preset-es2017'</span> 将ES2017转化成ES6,</span><br></pre></td></tr></table></figure>
<h2 id="将-babelrc文件中修改为以下内容"><a href="#将-babelrc文件中修改为以下内容" class="headerlink" title="将.babelrc文件中修改为以下内容:"></a>将<code>.babelrc</code>文件中修改为以下内容:</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">      <span class="string">"es2015"</span>,</span><br><span class="line">      <span class="string">"react"</span>,</span><br><span class="line">      <span class="string">"stage-2"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"plugins"</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="babel-preset-env"></a>babel-preset-env</h2><p>上面提到的各种preset的问题就是:<br>它们都太”重”了, 即包含了过多在某些情况下不需要的功能.</p>
<p>比如,现代的浏览器大多支持ES6的generator, 但是如果你使用babel-preset-es2015,它会将generator函数编译为复杂的ES5代码, 这是没有必要的.但使用babel-preset-env,我们可以声明环境, 然后该preset就会只编译包含我们所声明环境缺少的特性的代码,因此也是比较推荐的方式.</p>
<p>安装命令如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install babel-preset-env --save-dev</span><br></pre></td></tr></table></figure></p>
<p>更改.babelrc配置<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [<span class="string">"env"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当没有添加任何的配置选项时,babel-preset-env默认行为是和babel-preset-latest是一样的.<br>下面我们通过一些例子来看babel-preset-env的配置是如何使用的:</p>
<p>指定支持主流浏览器最新的两个版本以及IE 7+:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">"presets": [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"targets"</span>: &#123;</span><br><span class="line">          <span class="attr">"browsers"</span>: [<span class="string">"last 2 versions"</span>, <span class="string">"ie &gt;= 7"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>支持超过市场份额5%的浏览器:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"targets": &#123;</span><br><span class="line">  "browsers": "&gt; 5%"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>某个固定版本的浏览器:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">"targets": &#123;</span><br><span class="line">  "chrome": 56</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="二、命令行转码babel-cli"><a href="#二、命令行转码babel-cli" class="headerlink" title="二、命令行转码babel-cli"></a>二、命令行转码babel-cli</h1><p>安装命令如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --global babel-cli</span><br></pre></td></tr></table></figure></p>
<p>基本用法如下:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 转码结果输出到标准输出</span></span><br><span class="line">$ babel example.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转码结果写入一个文件</span></span><br><span class="line"><span class="comment"># --out-file 或 -o 参数指定输出文件</span></span><br><span class="line">$ babel example.js --out-file compiled.js</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ babel example.js -o compiled.js</span><br><span class="line"></span><br><span class="line"><span class="comment"># 整个目录转码</span></span><br><span class="line"><span class="comment"># --out-dir 或 -d 参数指定输出目录</span></span><br><span class="line">$ babel src --out-dir lib</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">$ babel src -d lib</span><br><span class="line"></span><br><span class="line"><span class="comment"># -s 参数生成source map文件</span></span><br><span class="line">$ babel src -d lib -s</span><br></pre></td></tr></table></figure></p>
<h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点:"></a>注意点:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- babel-cli:命令行转码</span><br><span class="line">- babel-node:babel-cli工具自带一个babel-node命令,提供一个支持ES6的REPL环境</span><br><span class="line">- babel-register:实时转码,所以只适合在开发环境使用</span><br><span class="line">- babel-core:如果某些代码需要调用Babel的API进行转码,就要使用babel-core模块</span><br><span class="line"></span><br><span class="line">babel-cli:</span><br><span class="line">一种使用方式就是全局安装:`npm install -g babel-cli` (可以通过 `npm root -g` 查看全局包安装目录),</span><br><span class="line">只要全局安装了 `babel-cli`,则会在命令行中多出一个命令:`babel`.</span><br><span class="line"></span><br><span class="line">这里如果使用全局安装的 `babel-cli` 进行转码是没有问题的,但是问题是如果一旦项目给了别人,</span><br><span class="line">别人不知道你使用了这个转码工具,所以解决方式就是将 `babel-cli` 安装到本地项目中:</span><br></pre></td></tr></table></figure>
<p>这种第三方命令行工具如果安装到本地项目,会在 <code>node_modules</code> 中生成一个目录:<code>.bin</code>,<br>然后第三方命令行工具会将对应的可执行文件放到该目录中.</p>
<p>这样的话,就可以直接在本地项目中使用该第三方命令行工具了.</p>
<p>对于如何使用,则可以通过配置 <code>package.json</code> 文件中的 <code>scripts</code> 字段来配置使用:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"babel-demo"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"babel demo1.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"babel-cli"</span>: <span class="string">"^6.22.2"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-es2015"</span>: <span class="string">"^6.22.0"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-react"</span>: <span class="string">"^6.22.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="babel-register-适合开发阶段-实时编码转换"><a href="#babel-register-适合开发阶段-实时编码转换" class="headerlink" title="babel-register(适合开发阶段,实时编码转换):"></a>babel-register(适合开发阶段,实时编码转换):</h2><p>babel-register只会对require命令加载的文件转码,而不会对当前文件转码.<br>另外,由于它是实时转码,所以只适合在开发环境使用.</p>
<h3 id="安装-babel-register"><a href="#安装-babel-register" class="headerlink" title="安装 babel-register"></a>安装 babel-register</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-register</span><br></pre></td></tr></table></figure>
<h3 id="添加一个傀儡文件-main-js"><a href="#添加一个傀儡文件-main-js" class="headerlink" title="添加一个傀儡文件(main.js):"></a>添加一个傀儡文件(main.js):</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'你的核心功能代码入口文件模块'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="使用-node-执行-main-js-而不是你的入口文件"><a href="#使用-node-执行-main-js-而不是你的入口文件" class="headerlink" title="使用 node 执行 main.js,而不是你的入口文件."></a>使用 node 执行 <code>main.js</code>,而不是你的入口文件.</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### --save 和 --save-dev</span></span><br><span class="line"></span><br><span class="line">通过 `--save` 参数安装的包,是将依赖项保存到 package.json 文件中的 dependencies 选项中.</span><br><span class="line">通过 `--save-dev` 参数安装的包,是将依赖项保存到 package.json 文件中的 devDependencies 选项中.</span><br><span class="line"></span><br><span class="line">无论是 `--save` 或者 `--save-dev` 安装的包,通过执行 `npm install` 都会将对应的依赖包安装进来.</span><br><span class="line"></span><br><span class="line">但是,在开发阶段会有一些仅仅用来辅助开发的一些第三方包或是工具,然后最终上线运行(到了生产环境),</span><br><span class="line">这些开发依赖项就不再需要了,就可以通过 `npm install --production` 命令仅仅安装 `dependencies` 中的</span><br><span class="line">依赖项.</span><br></pre></td></tr></table></figure>
<h2 id="babel-polyfill"><a href="#babel-polyfill" class="headerlink" title="babel-polyfill:"></a>babel-polyfill:</h2><p>Babel默认只转换新的JavaScript句法(syntax),而不转换新的API,比如Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise等全局对象,以及一些定义在全局对象上的方法(比如Object.assign)都不会转码.</p>
<p>举例来说,ES6在Array对象上新增了Array.from方法.Babel就不会转码这个方法.如果想让这个方法运行,必须使用babel-polyfill</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save babel-polyfill</span><br></pre></td></tr></table></figure>
<p>然后在运行文件的头部,添加以下行:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'babel-polyfill'</span>;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-polyfill'</span>);</span><br></pre></td></tr></table></figure></p>
<h2 id="babel-runtime"><a href="#babel-runtime" class="headerlink" title="babel-runtime:"></a>babel-runtime:</h2><p>与 babel-polyfill 一样,babel-runtime 的作用也是模拟 ES2015 环境.只不过,babel-polyfill 是针对全局环境的引入它的,babel-runtime 更像是分散的 polyfill 模块,<br>可以在模块里单独引入,比如 require(“babel-runtime/core-js/promise”)<br>也可以借助 Runtime transform 插件来自动化处理这一切:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save-dev babel-plugin-transform-runtime</span><br><span class="line">$ npm install --save babel-runtime</span><br></pre></td></tr></table></figure></p>
<p>然后配置.babelrc<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"plugins"</span>: [<span class="string">"transform-runtime"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/18/git配置流程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="胡剑">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HuJian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/18/git配置流程/" itemprop="url">服务器安装git步骤</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-18T23:23:14+08:00">
                2019-02-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/18/git配置流程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/18/git配置流程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端:"></a>服务端:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1,su root ==&gt; 切换到了root账户</span><br><span class="line">2,yum install -y git ==&gt; 安装git</span><br><span class="line">3,git --version ==&gt; 验证是否安装成功</span><br><span class="line">4,adduser git ==&gt; 添加git账户</span><br><span class="line">5,passwd git ==&gt; 修改git的密码</span><br><span class="line">6,<span class="built_in">cd</span> /home &amp;&amp; ls -al ==&gt; 查看git是否安装成功</span><br><span class="line">7,su git ==&gt; 切换到git账号</span><br><span class="line">8,<span class="built_in">cd</span> /home/git ==&gt; 进入git账户的主目录</span><br><span class="line">9,mkdir .ssh ==&gt; 创建.ssh的配置,如果此文件夹已经存在请忽略此步.</span><br><span class="line">10,<span class="built_in">cd</span> /home/git/.ssh ==&gt; 进入刚创建的.ssh目录</span><br><span class="line">11,touch authorized_keys ==&gt; 创建authorized_keys文件,此文件存放客户端远程访问的ssh的公钥</span><br><span class="line">12,chmod 700 /home/git/.ssh/</span><br><span class="line">   chmod 600 /home/git/.ssh/authorized_keys ==&gt; 设置权限,此步骤不能省略,而且权限值也不要改,不然会报错</span><br><span class="line">13,chown -R git:git git ==&gt; 将文件夹git的所有者所有组改为用户git</span><br></pre></td></tr></table></figure>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端:"></a>客户端:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1,ssh-keygen -t rsa -C <span class="string">"your_email"</span> ==&gt; 创建客户端的ssh私钥和公钥</span><br><span class="line">2,<span class="built_in">cd</span> /Users/xxx/.ssh ==&gt; 进入到.ssh文件夹下</span><br><span class="line">3,vim config ==&gt; 配置.ssh连接文件</span><br><span class="line">  写入</span><br><span class="line">  <span class="comment"># HostName       company.com ==&gt; 是目标主机的主机名,也就是平时我们使用ssh后面跟的地址名称,有域名的</span></span><br><span class="line">  Host           120.26.55.153 ==&gt; 没有域名的,ip地址</span><br><span class="line">  Port           800   ==&gt;  指定的端口号,默认端口为22,要和服务器的vim /etc/ssh/sshd_config下的端口一致!!!!!!!!!!</span><br><span class="line">  User           git   ==&gt;  指定的登陆用户名</span><br><span class="line">  IdentityFile   ~/.ssh/id_rsa ==&gt; 指定的私钥地址</span><br><span class="line"></span><br><span class="line">3,scp -P 800 ~/.ssh/id_rsa.pub git@120.26.55.153:.ssh/jerry.pub ==&gt; 端口不一致的情况下,上传到.ssh文件下,重命名为jerry.pub</span><br><span class="line">  scp ./id_rsa.pub git@120.26.55.153:.ssh/jerry.pub ==&gt; 端口一致的情况下上传</span><br></pre></td></tr></table></figure>
<h2 id="服务端-1"><a href="#服务端-1" class="headerlink" title="服务端:"></a>服务端:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1,su git ==&gt; 切换到git账户</span><br><span class="line">2,<span class="built_in">cd</span> /home/git/.ssh ==&gt; 进入到.ssh文件下</span><br><span class="line">3,ls -al ==&gt; 查看一下.ssh目录是否有authorized_keys和jerry.pub文件(刚上传的)</span><br><span class="line">4,cat jerry.pub &gt;&gt; authorized_keys ==&gt; &gt;&gt; 是在文件后面追加的意思,主要如果用其他编辑器,每个ssh的pub要单独一行,建议用cat命令方便简单.</span><br></pre></td></tr></table></figure>
<h2 id="客户端-1"><a href="#客户端-1" class="headerlink" title="客户端:"></a>客户端:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1,ssh git@120.26.55.153 ==&gt; 在客户端用ssh测试连接远程服务器,端口一致时的测试连接</span><br><span class="line">2,ssh username@hostname -p port ==&gt; 端口不一致时的测试连接</span><br></pre></td></tr></table></figure>
<h2 id="服务端-2"><a href="#服务端-2" class="headerlink" title="服务端:"></a>服务端:</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1,su git ==&gt; 切换到git账号</span><br><span class="line">2,<span class="built_in">cd</span> /home/git ==&gt; 进入git账号的用户主目录</span><br><span class="line">3,mkdir test.git  &amp;&amp; <span class="built_in">cd</span> test.git ==&gt; 在用户主目录下创建 test.git仓库的文件夹</span><br><span class="line">4,git init ==&gt; 在test.git目录下初始化git仓库</span><br><span class="line">5,git config receive.denyCurrentBranch ignore ==&gt; 设置允许远程接收文件,不然外部不可以上传文件</span><br><span class="line">6,chown -R git:git ../test.git ==&gt; 把仓库所属用户改为git</span><br><span class="line">7,<span class="built_in">cd</span> .git/hooks ==&gt; 进入隐藏文件夹.git下的文件</span><br><span class="line">8,vim post-receive ==&gt; 添加自动更新工作目录内容</span><br><span class="line">  WORK_TREE=<span class="string">'../'</span></span><br><span class="line">  git  --work-tree=<span class="string">"<span class="variable">$&#123;WORK_TREE&#125;</span>"</span> reset --hard</span><br><span class="line">chmod -R 755 post-receive ==&gt; post-receive 具有执行权限!!!!!!!</span><br></pre></td></tr></table></figure>
<h3 id="安全隐患防护"><a href="#安全隐患防护" class="headerlink" title="安全隐患防护"></a>安全隐患防护</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1,vim /etc/passwd ==&gt; 修改用户操作连接</span><br><span class="line">  <span class="comment"># 找到这句, 注意1000可能是别的数字</span></span><br><span class="line">  git:x:1000:1000::/home/git:/bin/bash</span><br><span class="line">  <span class="comment"># 改为:</span></span><br><span class="line">  git:x:1000:1000::/home/git:/bin/git-shell</span><br><span class="line">1,cat /etc/shells ==&gt; 检查`git-shell`是否已经在shells文件中</span><br><span class="line">2,<span class="built_in">which</span> git-shell ==&gt; 确定git-shell已经在你的系统里安装</span><br><span class="line">3,sudo vim /etc/shells ==&gt; 将上一条命令返回的路径添加进shells(通常git-shell路径为/usr/bin/git-shell)</span><br><span class="line">4,sudo chsh git -s $(<span class="built_in">which</span> git-shell) ==&gt; 把默认的shell替换成git-shell</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://avatars2.githubusercontent.com/u/46552129?s=460&v=4" alt="胡剑">
            
              <p class="site-author-name" itemprop="name">胡剑</p>
              <p class="site-description motion-element" itemprop="description">时间就是一个小偷,它让你猝不及防地失去,那些你很容易忽略掉的东西,当你记起时，却怎么也找不着了...</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/FassbenderMichael" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/540907171/activities" target="_blank" title="知乎">
                      
                        <i class="fa fa-fw fa-globe"></i>知乎</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/df1f61cabea9" target="_blank" title="简书">
                      
                        <i class="fa fa-fw fa-heartbeat"></i>简书</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.douban.com/people/179974868/" target="_blank" title="豆瓣">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>豆瓣</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">胡剑</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://fassbendermichael.disqus.com/count.js" async></script>
    

    

  




	





  














  





  

  

  

  
  

  

  

  

</body>
</html>
